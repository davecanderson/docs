<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JWT Auth Provider | Documentation</title>
    <meta name="description" content="ServiceStack Docs">
    <link rel="stylesheet" href="/assets/style.e46a7fd7.css">
    <link rel="modulepreload" href="/assets/chunks/TypeSenseDialog.7fced6a9.js">
    <link rel="modulepreload" href="/assets/chunks/KeyboardEvents.f3bcb94c.js">
    <link rel="modulepreload" href="/assets/chunks/jwt-service-clients.f6bff1a9.js">
    <link rel="modulepreload" href="/assets/app.2aea72c0.js">
    <link rel="modulepreload" href="/assets/jwt-authprovider.md.008f2feb.lean.js">
    
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-79ESXEMPL0"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-79ESXEMPL0");</script>
  <script src="/custom.js"></script>
  <script type="module" src="/custom.mjs"></script>
  <meta name="twitter:title" content="JWT Auth Provider | Documentation">
  <meta property="og:title" content="JWT Auth Provider | Documentation">
  </head>
  <body>
    <div id="app"><div><!----><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Documentation, back to home" data-v-675d8756 data-v-cc01ef16><!----> Documentation</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/templates-overview" data-v-b8818f8c>Project Templates <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/vue/" data-v-b8818f8c>Vue <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/autoquery" data-v-b8818f8c>AutoQuery <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/locode/" data-v-b8818f8c>Locode <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/auth" data-v-b8818f8c>Security <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/grpc" data-v-b8818f8c>gRPC <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/ormlite/" data-v-b8818f8c>OrmLite <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/redis/" data-v-b8818f8c>Redis <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/ServiceStack/docs" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><button class="flex rounded-full p-0 bg-gray-100 border-solid border-gray-100 text-gray-400 cursor-pointer hover:border-green-400 hover:bg-white hover:text-gray-600"><svg class="w-7 h-7 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16l2.879-2.879m0 0a3 3 0 104.243-4.242 3 3 0 00-4.243 4.242zM21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="text-lg mr-1">Search</span><span style="opacity:1;" class="hidden sm:block text-gray-400 text-sm leading-5 py-0 px-1.5 my-0.5 mr-1.5 border border-gray-300 border-solid rounded-md"><span class="sr-only">Press </span><kbd class="font-sans">/</kbd><span class="sr-only"> to search</span></span></button><!--]--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/templates-overview" data-v-b8818f8c>Project Templates <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/vue/" data-v-b8818f8c>Vue <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/autoquery" data-v-b8818f8c>AutoQuery <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/locode/" data-v-b8818f8c>Locode <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/auth" data-v-b8818f8c>Security <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/grpc" data-v-b8818f8c>gRPC <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/ormlite/" data-v-b8818f8c>OrmLite <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/redis/" data-v-b8818f8c>Redis <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/ServiceStack/docs" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">Security</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/auth">Overview</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/authentication-and-authorization">Authentication &amp; Authorization</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/auth-repository">Auth Repository</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/authentication-identity-servicestack">Using ServiceStack Auth in MVC</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/authentication-identity-aspnet">Using ASP.NET Identity Auth</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/authentication-identityserver">Using IdentityServer4 Auth</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/sessions">Sessions</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/jwt-authprovider">JWT AuthProvider</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#jwt-token-cookies">JWT Token Cookies</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#transparent-server-auto-refresh-of-jwt-tokens">Transparent Server Auto Refresh of JWT Tokens</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#revert-to-bearer-token-responses">Revert to Bearer Token Responses</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#sending-jwt-with-service-clients">Sending JWT with Service Clients</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#jwt-overview">JWT Overview</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#jwt-format">JWT Format</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#jwt-header">JWT Header</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#jwt-payload">JWT Payload</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#jwt-signature">JWT Signature</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#encrypted-jwe-tokens">Encrypted JWE Tokens</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#stateless-auth-microservices">Stateless Auth Microservices</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#retrieve-token-from-central-auth-server-using-credentials-auth">Retrieve Token from Central Auth Server using Credentials Auth</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#refresh-tokens">Refresh Tokens</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#automatically-refreshing-access-tokens">Automatically refreshing Access Tokens</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#using-an-alternative-jwt-server">Using an alternative JWT Server</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#handling-refresh-tokens-expiring">Handling Refresh Tokens Expiring</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#lifetimes-of-tokens">Lifetimes of tokens</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#convert-sessions-to-tokens">Convert Sessions to Tokens</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#request-jwt-cookie-is-set-on-authentication">Request JWT Cookie is set on Authentication</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#server-token-cookies">Server Token Cookies</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#converting-an-existing-authenticated-session-into-a-jwt-token">Converting an existing Authenticated Session into A JWT Token</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ajax-clients">Ajax Clients</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#switching-existing-sites-to-jwt">Switching existing Sites to JWT</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#fallback-auth-and-rsa-keys">Fallback Auth and RSA Keys</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#send-jwts-in-http-params">Send JWTs in HTTP Params</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#multiple-audiences">Multiple Audiences</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#adhoc-jwt-apis">Adhoc JWT APIs</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#creating-jwt-tokens-manually">Creating JWT Tokens Manually</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#validating-jwt-manually">Validating JWT Manually</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#large-profile-image-handling">Large Profile Image Handling</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#refresh-token-cookies-supported-in-all-service-clients">Refresh Token Cookies supported in all Service Clients</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#jwt-configuration">JWT Configuration</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#further-examples">Further Examples</a><!----></li></ul></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/api-key-authprovider">API Key AuthProvider</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/auth-signin-with-apple">Sign in with Apple AuthProvider</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/auth-restricting-services">Restricting Services</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/encrypted-messaging">Encrypted Messaging</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/auth-anti-forgery">Anti Forgery</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--[--><!----><!--]--><!--[--><h1>JWT Auth Provider</h1><!--]--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><iframe class="video-hd mt-8" src="https://www.youtube.com/embed/NTCUT7atoLo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe><p>The <code>JwtAuthProvider</code> is our integrated Auth solution for the popular <a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">JSON Web Tokens</a> (JWT) industry standard which is easily enabled by registering the <code>JwtAuthProvider</code> with the <code>AuthFeature</code> plugin:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthFeature</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IAuthProvider<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> <span class="token punctuation">{</span> AuthKey <span class="token operator">=</span> AesUtils<span class="token punctuation">.</span><span class="token function">CreateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CredentialsAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>At a minimum you&#39;ll need to specify the <code>AuthKey</code> that will be used to Sign and Verify JWT tokens. Whilst creating a new one in memory as above will work, a new Auth Key will be created every time the AppDomain recycles which will invalidate all existing JWT Tokens created with the previous key.</p><h3 id="generate-new-auth-key" tabindex="-1">Generate new Auth Key <a class="header-anchor" href="#generate-new-auth-key" aria-hidden="true">#</a></h3><p>You can create a new <strong>Base64 Auth Key</strong> by running the code snippet below locally:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> base64Key <span class="token operator">=</span> System<span class="token punctuation">.</span>Convert<span class="token punctuation">.</span><span class="token function">ToBase64String</span><span class="token punctuation">(</span>ServiceStack<span class="token punctuation">.</span>AesUtils<span class="token punctuation">.</span><span class="token function">CreateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You&#39;ll typically want to generate the AuthKey out-of-band and configure it with the <code>JwtAuthProvider</code> at registration which you can do in code using any of the <a href="/appsettings">AppSettings providers</a>:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    AuthKeyBase64 <span class="token operator">=</span> AppSettings<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;AuthKeyBase64&quot;</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>Or alternatively you can configure most <code>JwtAuthProvider</code> properties in your <strong>appsettings.json</strong> or <strong>Web.config</strong> <code>&lt;appSettings/&gt;</code> following the <code>jwt.{PropertyName}</code> format:</p><h4 id="appsettings-json" tabindex="-1">appsettings.json <a class="header-anchor" href="#appsettings-json" aria-hidden="true">#</a></h4><div class="language-json"><pre><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jwt.AuthKeyBase64&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{Base64AuthKey}&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="web-config" tabindex="-1">Web.config <a class="header-anchor" href="#web-config" aria-hidden="true">#</a></h4><div class="language-xml"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jwt.AuthKeyBase64<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{Base64AuthKey}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>As with all crypto keys you&#39;ll want to keep them confidential as if anyone gets a hold of your AuthKey they&#39;ll be able to forge and sign their own JWT tokens letting them be able to impersonate any user, roles or permissions!</p><h3 id="upgrade-to-v5-9-2" tabindex="-1">Upgrade to v5.9.2 <a class="header-anchor" href="#upgrade-to-v5-9-2" aria-hidden="true">#</a></h3><p>If you&#39;re using JWT Auth please upgrade to v5.9.2 when possible to resolve a JWT signature verification issue comparing different lengthed signatures.</p><p>If you&#39;re not able to upgrade, older versions should ensure a minimum length signature with a custom <code>ValidateToken</code>, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ValidateToken <span class="token operator">=</span> <span class="token punctuation">(</span>js<span class="token punctuation">,</span>req<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> req<span class="token punctuation">.</span><span class="token function">GetJwtToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">LastRightPart</span><span class="token punctuation">(</span><span class="token char">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FromBase64UrlSafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Length <span class="token operator">&gt;=</span> <span class="token number">32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="jwt-token-cookies" tabindex="-1">JWT Token Cookies <a class="header-anchor" href="#jwt-token-cookies" aria-hidden="true">#</a></h2><p>From <strong>v6+</strong> the default configuration of the <a href="/jwt-authprovider">JWT Auth Provider</a> uses <strong>HTTP Token Cookies by default</strong> which is both recommended <a href="https://stormpath.com/blog/where-to-store-your-jwts-cookies-vs-html5-web-storage#where-to-store-your-jwts" target="_blank" rel="noopener noreferrer">for Web Apps</a> that&#39;s also better able to support effortless JWT Token management features.</p><p>It allows for a more interoperable and seamless solution as it already works with the normal client logic for authenticating using normal <a href="/sessions">Server Session Cookies</a>, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">let</span> api <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">api</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> provider<span class="token punctuation">:</span>&#39;credentials&#39;<span class="token punctuation">,</span> userName<span class="token punctuation">,</span> password<span class="token punctuation">,</span> rememberMe <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Which also works transparently after a configuring to use JWT on the server to switch to using stateless JWT Tokens, as in both cases the HTTP Clients utilize Cookies to enable authenticated requests.</p><h3 id="transparent-server-auto-refresh-of-jwt-tokens" tabindex="-1">Transparent Server Auto Refresh of JWT Tokens <a class="header-anchor" href="#transparent-server-auto-refresh-of-jwt-tokens" aria-hidden="true">#</a></h3><p>JWTs enable stateless authentication of clients without servers needing to maintain any Auth state in server infrastructure or perform any I/O to validate a token. As such, <a href="/jwt-authprovider#stateless-auth-microservices">JWTs are a popular choice for Microservices</a> as they only need to configured with confidential keys to validate access.</p><p>But to be able to terminate a users access, they need to revalidate their eligibility to verify they&#39;re still allowed access (e.g. deny Locked out users). This JWT revalidation pattern is implemented using <a href="/jwt-authprovider#refresh-tokens">Refresh Tokens</a> which are used to request revalidation of their access with a new JWT Access Token which they&#39;ll be able to use to make authenticated requests until it expires.</p><p>Previously the management of <strong>auto refreshing expired JWT Access Tokens</strong> was done with logic built into each of our smart generic Service Clients. But switching to use Token Cookies allows us to implement the revalidation logic on the server where it&#39;s now able to do this <strong>transparently for all HTTP Clients</strong>, i.e. it&#39;s no longer just limited to our typed Service Clients.</p><h3 id="revert-to-bearer-token-responses" tabindex="-1">Revert to Bearer Token Responses <a class="header-anchor" href="#revert-to-bearer-token-responses" aria-hidden="true">#</a></h3><p>If you prefer not to use HTTP Token Cookies and want to manually handle JWT Auth Tokens, you can revert to returning JWT Tokens in <code>AuthenticateResponse</code> API responses with:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    UseTokenCookie <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><p>JWT Token Cookies are supported for most built-in Auth Providers including <code>Authenticate</code> Requests as well as <strong>OAuth Web Flow</strong> Sign Ins.</p><p>The alternative to configuring on the server is for clients to request it with <a href="#request-jwt-cookie-is-set-on-authentication">UseTokenCookie on the Authenticate Request</a> or in a <a href="#switching-existing-sites-to-jwt">hidden FORM Input</a>.</p><h4 id="requiresecureconnection" tabindex="-1">RequireSecureConnection <a class="header-anchor" href="#requiresecureconnection" aria-hidden="true">#</a></h4><p>The JWT Auth Provider defaults to <code>RequireSecureConnection=true</code> which mandates for Authentication via either Provider to happen over a secure (HTTPS) connection as both bearer tokens should be kept highly confidential. You can specify <code>RequireSecureConnection=false</code> to disable this requirement for testing or within controlled internal environments.</p><h3 id="sending-jwt-with-service-clients" tabindex="-1">Sending JWT with Service Clients <a class="header-anchor" href="#sending-jwt-with-service-clients" aria-hidden="true">#</a></h3><p>JWT Tokens can be sent using the Bearer Token support in all HTTP and Service Clients:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    BearerToken <span class="token operator">=</span> jwtToken
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token string">&quot;https://example.org/secured&quot;</span><span class="token punctuation">.</span><span class="token function">GetJsonFromUrlAsync</span><span class="token punctuation">(</span>
    <span class="token named-parameter punctuation">requestFilter</span><span class="token punctuation">:</span> req <span class="token operator">=&gt;</span> req<span class="token punctuation">.</span><span class="token function">AddBearerToken</span><span class="token punctuation">(</span>jwtToken<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The Service Clients offer additional high-level functionality where it&#39;s able to transparently request a new JWT Token after it expires by handling when the configured JWT Token becomes invalidated in the <code>OnAuthenticationRequired</code> callback. Here we can retrieve a new JWT Token that we can fetch using a different Service Client accessing a centralized and independent Auth Microservice that&#39;s configured with both API Key and JWT Token Auth Providers. We can fetch a new JWT Token by calling ServiceStack&#39;s built-in <code>Authenticate</code> Service with our <strong>secret</strong> API Key (that by default never invalidates unless revoked).</p><p>If authenticated, sending an empty <code>Authenticate()</code> DTO will return the currently Authenticated User Info that also generates a new JWT Token from the User&#39;s Authenticated Session and returns it in the <code>BearerToken</code> Response DTO property which we can use to update our invalidated JWT Token.</p><p>All together we can configure our Service Client to transparently refresh expired JWT Tokens with just:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> authClient <span class="token operator">=</span> <span class="token function">JsonServiceClient</span><span class="token punctuation">(</span>centralAuthBaseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NetworkCredential</span><span class="token punctuation">(</span>apiKey<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span>OnAuthenticationRequired <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    client<span class="token punctuation">.</span>BearerToken <span class="token operator">=</span> authClient<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BearerToken<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="sending-jwt-using-cookies" tabindex="-1">Sending JWT using Cookies <a class="header-anchor" href="#sending-jwt-using-cookies" aria-hidden="true">#</a></h4><p>To <a href="https://stormpath.com/blog/where-to-store-your-jwts-cookies-vs-html5-web-storage" target="_blank" rel="noopener noreferrer">improve accessibility with Ajax clients</a> JWT Tokens can also be sent using the <code>ss-tok</code> Cookie, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">SetCookie</span><span class="token punctuation">(</span><span class="token string">&quot;ss-tok&quot;</span><span class="token punctuation">,</span> jwtToken<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Equivalent to: </span>
client<span class="token punctuation">.</span><span class="token function">SetTokenCookie</span><span class="token punctuation">(</span>jwtToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We&#39;ll walk through an example of how you can access JWT Tokens as well as how you can convert Authenticated Sessions into JWT Tokens and assign it to use a <strong>Secure</strong> and <strong>HttpOnly</strong> Cookie later on.</p><h4 id="sending-jwt-in-request-dtos" tabindex="-1">Sending JWT in Request DTOs <a class="header-anchor" href="#sending-jwt-in-request-dtos" aria-hidden="true">#</a></h4><p>Similar to the <code>IHasSessionId</code> interface Request DTOs can also implement <code>IHasBearerToken</code> to send Bearer Tokens as an alternative for sending them in HTTP Headers or Cookies, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Secure</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IHasBearerToken</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> BearerToken <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secure</span> <span class="token punctuation">{</span> BearerToken <span class="token operator">=</span> jwtToken<span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternatively you can set the <code>BearerToken</code> property on the Service Client once where it will automatically populate all Request DTOs that implement <code>IHasBearerToken</code>, e.g:</p><div class="language-csharp"><pre><code>client<span class="token punctuation">.</span>BearerToken <span class="token operator">=</span> jwtToken<span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secure</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="jwt-overview" tabindex="-1">JWT Overview <a class="header-anchor" href="#jwt-overview" aria-hidden="true">#</a></h3><p>A nice property of JWT tokens is that they allow for truly stateless authentication where API Keys and user credentials can be maintained in a decentralized Auth Service that&#39;s kept isolated from the rest of your System, making them optimal for use in Microservice architectures.</p><p>Being self-contained lends JWT tokens to more scalable, performant and flexible architectures as they don&#39;t require any I/O or any state to be accessed from App Servers to validate the JWT Tokens, this is unlike all other Auth Providers which requires at least a DB, Cache or Network hit to authenticate the user.</p><p>A good introduction into JWT is available from the JWT website: <a href="https://jwt.io/introduction/" target="_blank" rel="noopener noreferrer">jwt.io/introduction/</a> whilst <a href="https://float-middle.com/json-web-tokens-jwt-vs-sessions/" target="_blank" rel="noopener noreferrer">JWT vs Sessions</a> is a good article on advantages of using JWT instead of Sessions.</p><h3 id="jwt-format" tabindex="-1">JWT Format <a class="header-anchor" href="#jwt-format" aria-hidden="true">#</a></h3><p>Essentially JWT&#39;s consist of 3 parts separated by <code>.</code> with each part encoded in <a href="https://tools.ietf.org/html/rfc4648#section-5" target="_blank" rel="noopener noreferrer">Base64url Encoding</a> making it safe to encode both text and binary using only URL-safe (i.e. non-escaping required) chars in the following format:</p><pre><code>Base64UrlHeader.Base64UrlPayload.Base64UrlSignature 
</code></pre><p>Where just like the API Key, JWT&#39;s can be sent as a Bearer Token in the <code>Authorization</code> HTTP Request Header.</p><h3 id="jwt-header" tabindex="-1">JWT Header <a class="header-anchor" href="#jwt-header" aria-hidden="true">#</a></h3><p>The header typically consists of two parts: the type of the token and the hashing algorithm being used which is typically just:</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;alg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HS256&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;typ&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JWT&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We also send the &quot;kid&quot; <a href="http://self-issued.info/docs/draft-jones-json-web-token-01.html#rfc.section.5.1" target="_blank" rel="noopener noreferrer">Key Id</a> used to identify which key should be used to validate the signature to help with seamless key rotations in future. If not specified the KeyId defaults to the <strong>first 3 chars</strong> of the Base64 HMAC or RSA Public Key Modulus.</p><h3 id="jwt-payload" tabindex="-1">JWT Payload <a class="header-anchor" href="#jwt-payload" aria-hidden="true">#</a></h3><p>The Payload contains the essential information of a JWT Token which is made up of &quot;claims&quot;, i.e. statements and metadata about a user which are categorized into 3 groups:</p><ul><li><a href="https://tools.ietf.org/html/rfc7519#section-4.1" target="_blank" rel="noopener noreferrer">Registered Claim Names</a> - containing a known set of reserved names predefined in the JWT Standard</li><li><a href="https://tools.ietf.org/html/rfc7519#section-4.2" target="_blank" rel="noopener noreferrer">Public Claim Names</a> - additional common names that are registered in the <a href="http://www.iana.org/assignments/jwt/jwt.xhtml" target="_blank" rel="noopener noreferrer">IANA &quot;JSON Web Token Claims&quot; registry</a> or otherwise adopt a Collision-Resistant name, e.g. prefixed by a namespace</li><li><a href="https://tools.ietf.org/html/rfc7519#section-4.3" target="_blank" rel="noopener noreferrer">Private Claim Names</a> - any other metadata you wish to include about an entity</li></ul><p>We use the Payload to store essential information about the user which we use to validate the token and populate the session. Which typically contains:</p><ul><li><strong>iss</strong> (<a href="https://tools.ietf.org/html/rfc7519#section-4.1.1" target="_blank" rel="noopener noreferrer">Issuer</a>) - the principal that issued the JWT. Can be set with <code>JwtAuthProvider.Issuer</code>, defaults to <strong>ssjwt</strong></li><li><strong>sub</strong> (<a href="https://tools.ietf.org/html/rfc7519#section-4.1.2" target="_blank" rel="noopener noreferrer">Subject</a>) - identifies the subject of the JWT, used to store the User&#39;s <strong>UserAuthId</strong></li><li><strong>iat</strong> (<a href="https://tools.ietf.org/html/rfc7519#section-4.1.6" target="_blank" rel="noopener noreferrer">Issued At</a>) - when JWT Token was issued. Can use <code>InvalidateTokensIssuedBefore</code> to invalidate tokens issued before a specific date</li><li><strong>exp</strong> (<a href="https://tools.ietf.org/html/rfc7519#section-4.1.4" target="_blank" rel="noopener noreferrer">Expiration Time</a>) - when the JWT expires. Initialized with <code>JwtAuthProvider.ExpireTokensIn</code> from date of issue (default <strong>14 days</strong>)</li><li><strong>aud</strong> (<a href="https://tools.ietf.org/html/rfc7519#section-4.1.3" target="_blank" rel="noopener noreferrer">Audience</a>) - identifies the recipient of the JWT. Can be set with <code>JwtAuthProvider.Audience</code>, defaults to <code>null</code> (Optional)</li></ul><p>The remaining information in the JWT Payload is used to populate the Users Session, to maximize interoperability we&#39;ve used the most appropriate <a href="http://www.iana.org/assignments/jwt/jwt.xhtml" target="_blank" rel="noopener noreferrer">Public Claim Names</a> where possible:</p><ul><li><strong>email</strong> &lt;- <code>session.Email</code></li><li><strong>given_name</strong> &lt;- <code>session.FirstName</code></li><li><strong>family_name</strong> &lt;- <code>session.LastName</code></li><li><strong>name</strong> &lt;- <code>session.DisplayName</code></li><li><strong>preferred_username</strong> &lt;- <code>session.UserName</code></li><li><strong>picture</strong> &lt;- <code>session.ProfileUrl</code></li></ul><p>We also need to capture Users Roles and Permissions but as there&#39;s no Public Claim Name for this yet we&#39;re using <a href="https://azure.microsoft.com/en-us/documentation/articles/active-directory-token-and-claims/" target="_blank" rel="noopener noreferrer">Azure&#39;s Active Directory Conventions</a> where User Roles are stored in <strong>roles</strong> as a JSON Array and similarly, Permissions are stored in <strong>perms</strong>.</p><p>To keep the JWT Token small we&#39;re only storing the essential User Info above in the Token, which means when the Token is restored it will only be partially populated. You can detect when a Session was partially populated from a JWT Token with the new <code>FromToken</code> boolean property.</p><h4 id="limit-to-essential-info" tabindex="-1">Limit to Essential Info <a class="header-anchor" href="#limit-to-essential-info" aria-hidden="true">#</a></h4><p>Only the above partial information is included in JWT payloads as JWTs are typically resent with every request that adds overhead to each HTTP Request so special consideration should be given to limit its payload to only include essential information identifying the User, any authorization info or other info that needs to accessed by most requests, e.g. TenantId for usage in partitioned queries or Display Info shown on each server generated page, etc.</p><p>Any other info is recommended to not be included in JWT&#39;s, instead they should be sourced from the App&#39;s data sources using the identifying user info stored in JWTs when needed.</p><p>You can add any additional properties you want included in JWTs and authenticated User Infos by using the <code>CreatePayloadFilter</code> and <code>PopulateSessionFilter</code> filters below, be mindful to include only minimal essential info and keep the properties names small to reduce the size (and request overhead) of JWTs.</p><h4 id="modifying-the-payload" tabindex="-1">Modifying the Payload <a class="header-anchor" href="#modifying-the-payload" aria-hidden="true">#</a></h4><p>Whilst only limited info is embedded in the payload by default, all matching <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/AuthUserSession.cs" target="_blank" rel="noopener noreferrer">AuthUserSession</a> properties embedded in the token will also be populated on the Session, which you can add to the payload using the <code>CreatePayloadFilter</code> delegate. So if you also want to have access to when the user was registered you can add it to the payload with:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    CreatePayloadFilter <span class="token operator">=</span> <span class="token punctuation">(</span>payload<span class="token punctuation">,</span>session<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
        payload<span class="token punctuation">[</span><span class="token string">&quot;CreatedAt&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> session<span class="token punctuation">.</span>CreatedAt<span class="token punctuation">.</span><span class="token function">ToUnixTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can also use the filter to modify any existing property which you can use to change the behavior of the JWT Token, e.g. we can add a special exception extending the JWT Expiration to all Users from Acme Inc with:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    CreatePayloadFilter <span class="token operator">=</span> <span class="token punctuation">(</span>payload<span class="token punctuation">,</span>session<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>session<span class="token punctuation">.</span>Email<span class="token punctuation">.</span><span class="token function">EndsWith</span><span class="token punctuation">(</span><span class="token string">&quot;@acme.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
            payload<span class="token punctuation">[</span><span class="token string">&quot;exp&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">.</span><span class="token function">AddYears</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToUnixTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Likewise you can modify how the Users Session is populated from the custom JWT with the <code>PopulateSessionFilter</code>, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    PopulateSessionFilter <span class="token operator">=</span> <span class="token punctuation">(</span>session<span class="token punctuation">,</span>payload<span class="token punctuation">,</span>req<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
        session<span class="token punctuation">.</span>CreatedAt <span class="token operator">=</span> <span class="token keyword">long</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token string">&quot;CreatedAt&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FromUnixTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If needed you can also modify JWT Headers with the <code>CreateHeaderFilter</code> delegate.</p><h3 id="jwt-signature" tabindex="-1">JWT Signature <a class="header-anchor" href="#jwt-signature" aria-hidden="true">#</a></h3><p>JWT Tokens are possible courtesy of the cryptographic signature added to the end of the message that&#39;s used to Authenticate and Verify that a Message hasn&#39;t been tampered with. As long as the message signature validates with our <code>AuthKey</code> we can be certain the contents of the message haven&#39;t changed from when it was created by either ourselves or someone else with access to our AuthKey.</p><p>JWT standard allows for a number of different Hashing Algorithms although requires at least the <strong>HM256</strong> HMAC SHA-256 to be supported which is the default. The full list of Symmetric HMAC and Asymmetric RSA Algorithms <code>JwtAuthProvider</code> supports include:</p><ul><li><strong>HS256</strong> - Symmetric HMAC SHA-256 algorithm</li><li><strong>HS384</strong> - Symmetric HMAC SHA-384 algorithm</li><li><strong>HS512</strong> - Symmetric HMAC SHA-512 algorithm</li><li><strong>RS256</strong> - Asymmetric RSA with PKCS#1 padding with SHA-256</li><li><strong>RS384</strong> - Asymmetric RSA with PKCS#1 padding with SHA-384</li><li><strong>RS512</strong> - Asymmetric RSA with PKCS#1 padding with SHA-512</li></ul><p>HMAC is the simplest to use as it lets you use the same AuthKey to Sign and Verify the message.</p><p>But if preferred you can use an RSA Key to sign and verify tokens by changing the <code>HashAlgorithm</code> and specifying a RSA Private Key:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    HashAlgorithm <span class="token operator">=</span> <span class="token string">&quot;RS256&quot;</span><span class="token punctuation">,</span>
    PrivateKeyXml <span class="token operator">=</span> AppSettings<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;PrivateKeyXml&quot;</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>If you don&#39;t have a RSA Private Key, one can be created with:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> privateKey <span class="token operator">=</span> RsaUtils<span class="token punctuation">.</span><span class="token function">CreatePrivateKeyParams</span><span class="token punctuation">(</span>RsaKeyLengths<span class="token punctuation">.</span>Bit2048<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And its public key can be extracted using <code>ToPublicRsaParameters()</code> extension method, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> publicKey <span class="token operator">=</span> privateKey<span class="token punctuation">.</span><span class="token function">ToPublicRsaParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Then to serialize RSA Keys, you can then export them to XML with:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> privateKeyXml <span class="token operator">=</span> privateKey<span class="token punctuation">.</span><span class="token function">ToPrivateKeyXml</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token keyword">var</span></span> publicKeyXml <span class="token operator">=</span> privateKey<span class="token punctuation">.</span><span class="token function">ToPublicKeyXml</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The behavior of using RSA to sign the JWT Tokens is mostly transparent but instead of using the AuthKey to both Sign and Verify the JWT Payload, it&#39;s signed with the Private Key and verified using the Public Key. New tokens will also have the <strong>alg</strong> JWT Header set to <strong>RS256</strong> to reflect the new HashAlgorithm used.</p><h3 id="encrypted-jwe-tokens" tabindex="-1">Encrypted JWE Tokens <a class="header-anchor" href="#encrypted-jwe-tokens" aria-hidden="true">#</a></h3><p>Something that&#39;s not immediately obvious is that while JWT Tokens are signed to prevent tampering and verify authenticity, they&#39;re not encrypted and can easily be read by decoding the URL-safe Base64 string. This is a feature of JWT where it allows Client Apps to inspect the User&#39;s claims and hide functionality they don&#39;t have access to, it also means that JWT Tokens are debuggable and can be inspected for whenever you need to track down unexpected behavior.</p><p>But there may be times when you want to embed sensitive information in your JWT Tokens in which case you&#39;ll want to enable Encryption, which can be done with:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    PrivateKeyXml <span class="token operator">=</span> AppSettings<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;PrivateKeyXml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    EncryptPayload <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When turning on encryption, tokens are instead created following the <a href="https://tools.ietf.org/html/rfc7516#section-3" target="_blank" rel="noopener noreferrer">JSON Web Encryption (JWE)</a> standard where they&#39;ll be encoded in the 5-part <a href="https://tools.ietf.org/html/rfc7516#section-3.1" target="_blank" rel="noopener noreferrer">JWE Compact Serialization</a> format:</p><div class="language-"><pre><code>BASE64URL(UTF8(JWE Protected Header)) || &#39;.&#39; ||
BASE64URL(JWE Encrypted Key)          || &#39;.&#39; ||
BASE64URL(JWE Initialization Vector)  || &#39;.&#39; ||
BASE64URL(JWE Ciphertext)             || &#39;.&#39; ||
BASE64URL(JWE Authentication Tag)
</code></pre></div><p>JwtAuthProvider&#39;s JWE implementation uses RSAES OAEP for Key Encryption and AES/128/CBC HMAC SHA256 for Content Encryption, closely following <a href="https://tools.ietf.org/html/rfc7516#appendix-A.2" target="_blank" rel="noopener noreferrer">JWE&#39;s AES_128_CBC_HMAC_SHA_256 Example</a> where a new MAC Auth and AES Crypt Key and IV are created for each Token. The Content Encryption Key (CEK) used to Encrypt and Authenticate the payload is encrypted using the Public Key and decrypted with the Private Key so only Systems with access to the Private Key will be able to Decrypt, Validate and Read the Token&#39;s payload.</p><h3 id="stateless-auth-microservices" tabindex="-1">Stateless Auth Microservices <a class="header-anchor" href="#stateless-auth-microservices" aria-hidden="true">#</a></h3><p>One of JWT&#39;s most appealing features is its ability to decouple the System that provides User Authentication Services and issues tokens from all the other Systems but are still able provide protected Services although no longer needs access to a User database or Session data store to facilitate it, as sessions can now be embedded in Tokens and its state maintained and sent by clients instead of accessed from each App Server. This is ideal for Microservice architectures where Auth Services can be isolated into a single externalized System.</p><p>With this use-case in mind we&#39;ve decoupled <code>JwtAuthProvider</code> in 2 classes:</p><ul><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/Auth/JwtAuthProviderReader.cs" target="_blank" rel="noopener noreferrer">JwtAuthProviderReader</a> - Responsible for validating and creating Authenticated User Sessions from tokens</li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/Auth/JwtAuthProvider.cs" target="_blank" rel="noopener noreferrer">JwtAuthProvider</a> - Inherits <code>JwtAuthProviderReader</code> to also be able to Issue, Encrypt and provide access to tokens</li></ul><h4 id="services-only-validating-tokens" tabindex="-1">Services only Validating Tokens <a class="header-anchor" href="#services-only-validating-tokens" aria-hidden="true">#</a></h4><p>This lets us configure our Microservices that we want to enable Authentication via JWT Tokens down to just:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">Container</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthFeature</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthUserSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IAuthProvider<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProviderReader</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                HashAlgorithm <span class="token operator">=</span> <span class="token string">&quot;RS256&quot;</span><span class="token punctuation">,</span>
                PublicKeyXml <span class="token operator">=</span> AppSettings<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;PublicKeyXml&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Or if you want to just use a single AuthKey for both Issuing and Validating tokens:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthFeature</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthUserSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProviderReader</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Which can be configured in <a href="/appsettings">AppSettings</a>:</p><div class="language-xml"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jwt.AuthKeyBase64<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{Base64AuthKey}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>Which no longer needs access to a <a href="/authentication-and-authorization#userauth-persistence---the-iuserauthrepository">IUserAuthRepository</a> or <a href="/sessions">Sessions</a> since they&#39;re populated entirely from JWT Tokens. Whilst you can use the default <strong>HS256</strong> HashAlgorithm, RSA is ideal for this use-case as you can limit access to the <strong>PrivateKey</strong> to only the central Auth Service issuing the tokens and then only distribute the <strong>PublicKey</strong> to each Service which needs to validate them.</p><h4 id="service-issuing-tokens" tabindex="-1">Service Issuing Tokens <a class="header-anchor" href="#service-issuing-tokens" aria-hidden="true">#</a></h4><p>As we can now contain all our Systems Auth Functionality to a single System we can open it up to support multiple Auth Providers as it only needs to be maintained in a central location but is still able to benefit all our Microservices that are only configured to validate JWT Tokens.</p><p>Here&#39;s a popular Auth Server configuration example which stores all User Auth information as well as User Sessions in SQL Server and is configured to support many of ServiceStack&#39;s Auth and OAuth providers:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">Container</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Store UserAuth in SQL Server</span>
    <span class="token class-name"><span class="token keyword">var</span></span> dbFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OrmLiteConnectionFactory</span><span class="token punctuation">(</span>
        AppSettings<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;LiveDb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SqlServerDialect<span class="token punctuation">.</span>Provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDbConnectionFactory<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>dbFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IAuthRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OrmLiteAuthRepository</span><span class="token punctuation">(</span>dbFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span> UseDistinctRoleTables <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Create UserAuth RDBMS Tables</span>
    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IAuthRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">InitSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Also store User Sessions in SQL Server</span>
    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterAs</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrmLiteCacheClient<span class="token punctuation">,</span> ICacheClient<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ICacheClient<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">InitSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//Add Support for </span>
    Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthFeature</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthUserSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IAuthProvider<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                HashAlgorithm <span class="token operator">=</span> <span class="token string">&quot;RS256&quot;</span><span class="token punctuation">,</span>
                PrivateKeyXml <span class="token operator">=</span> AppSettings<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;PrivateKeyXml&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ApiKeyAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment">//Sign-in with API Key</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CredentialsAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token comment">//Sign-in with UserName/Password credentials</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BasicAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token comment">//Sign-in with HTTP Basic Auth</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DigestAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment">//Sign-in with HTTP Digest Auth</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TwitterAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token comment">//Sign-in with Twitter</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FacebookAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token comment">//Sign-in with Facebook</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">YahooOpenIdOAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">//Sign-in with Yahoo OpenId</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenIdOAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token comment">//Sign-in with Custom OpenId</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GoogleOAuth2Provider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token comment">//Sign-in with Google OAuth2 Provider</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LinkedInOAuth2Provider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">//Sign-in with LinkedIn OAuth2 Provider</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GithubAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment">//Sign-in with GitHub OAuth Provider</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">YandexAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment">//Sign-in with Yandex OAuth Provider        </span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">VkAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment">//Sign-in with VK.com OAuth Provider </span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>With this setup we can Authenticate using any of the supported Auth Providers with our central Auth Server, retrieve the generated Token and use it to communicate with any our Microservices configured to validate tokens:</p><h3 id="retrieve-token-from-central-auth-server-using-credentials-auth" tabindex="-1">Retrieve Token from Central Auth Server using Credentials Auth <a class="header-anchor" href="#retrieve-token-from-central-auth-server-using-credentials-auth" aria-hidden="true">#</a></h3><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> authClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>centralAuthBaseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> authResponse <span class="token operator">=</span> authClient<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span> <span class="token punctuation">{</span>
    provider <span class="token operator">=</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span>
    UserName <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>
    Password <span class="token operator">=</span> <span class="token string">&quot;pass&quot;</span><span class="token punctuation">,</span>
    RememberMe <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    BearerToken <span class="token operator">=</span> authResponse<span class="token punctuation">.</span>BearerToken <span class="token comment">//Send JWT in HTTP Authorization Request Header</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Once the ServiceClient is configured it can also optionally be converted to send the JWT Token using the <code>ss-tok</code> Cookie instead by <a href="/jwt-authprovider#sending-jwt-with-service-clients">calling <code>ConvertSessionToToken</code></a>, e.g:</p><div class="language-csharp"><pre><code>
client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConvertSessionToToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span>BearerToken <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// No longer needed as JWT is automatically sent in ss-tok Cookie</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="retrieve-token-from-central-auth-server-using-api-key" tabindex="-1">Retrieve Token from Central Auth Server using API Key <a class="header-anchor" href="#retrieve-token-from-central-auth-server-using-api-key" aria-hidden="true">#</a></h4><p>You can also choose to Authenticate with any AuthProvider and the <code>Authenticate</code> Service will return the JWT Token if Authentication was successful.</p><p>The example below uses the JWT Token authenticates with the central Auth Server via its configured <a href="/api-key-authprovider">API Key Auth Provider</a>. If successful the generated JWT can be populated in any of your Service Clients as normal, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> authClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>centralAuthBaseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NetworkCredential</span><span class="token punctuation">(</span>apiKey<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> jwtToken <span class="token operator">=</span> authClient<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BearerToken<span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>service1BaseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span> BearerToken <span class="token operator">=</span> jwtToken <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="retrieve-token-with-http-basic-auth" tabindex="-1">Retrieve Token with HTTP Basic Auth <a class="header-anchor" href="#retrieve-token-with-http-basic-auth" aria-hidden="true">#</a></h4><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> authClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>centralAuthBaseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NetworkCredential</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> jwtToken <span class="token operator">=</span> authClient<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BearerToken<span class="token punctuation">;</span>
</code></pre></div><h4 id="retrieve-token-with-credentials-auth" tabindex="-1">Retrieve Token with Credentials Auth <a class="header-anchor" href="#retrieve-token-with-credentials-auth" aria-hidden="true">#</a></h4><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> authClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>centralAuthBaseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> jwtToken <span class="token operator">=</span> authClient<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span> <span class="token punctuation">{</span>
    provider <span class="token operator">=</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span>
    UserName <span class="token operator">=</span> username<span class="token punctuation">,</span>
    Password <span class="token operator">=</span> password
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BearerToken<span class="token punctuation">;</span>
</code></pre></div><h2 id="refresh-tokens" tabindex="-1">Refresh Tokens <a class="header-anchor" href="#refresh-tokens" aria-hidden="true">#</a></h2><p>Just like JWT Tokens, Refresh Tokens are populated on the <code>AuthenticateResponse</code> DTO after successfully authenticating via any registered Auth Provider, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span> <span class="token punctuation">{</span>
    provider <span class="token operator">=</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span>
    UserName <span class="token operator">=</span> userName<span class="token punctuation">,</span>
    Password <span class="token operator">=</span> password<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> jwtToken <span class="token operator">=</span> response<span class="token punctuation">.</span>BearerToken<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> refreshToken <span class="token operator">=</span> response<span class="token punctuation">.</span>RefreshToken<span class="token punctuation">;</span>
</code></pre></div><h3 id="automatically-refreshing-access-tokens" tabindex="-1">Automatically refreshing Access Tokens <a class="header-anchor" href="#automatically-refreshing-access-tokens" aria-hidden="true">#</a></h3><p>The <code>RefreshToken</code> property in all Service Clients can be used to instruct the client to automatically retrieve a new JWT Token behind-the-scenes when the original JWT token has expired, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    BearerToken <span class="token operator">=</span> jwtToken<span class="token punctuation">,</span>
    RefreshToken <span class="token operator">=</span> refreshToken<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You don&#39;t even need to configure the client with a JWT Token as it will also fetch a new one on first use:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    RefreshToken <span class="token operator">=</span> refreshToken<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="using-an-alternative-jwt-server" tabindex="-1">Using an alternative JWT Server <a class="header-anchor" href="#using-an-alternative-jwt-server" aria-hidden="true">#</a></h3><p>By default Service Clients will assume they should call the same ServiceStack Instance at the BaseUrl it&#39;s configured with to fetch new JWT Tokens. If instead refresh tokens need to be sent to a different server, it can be specified using the <code>RefreshTokenUri</code> property, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    RefreshToken <span class="token operator">=</span> refreshToken<span class="token punctuation">,</span>
    RefreshTokenUri <span class="token operator">=</span> authBaseUrl <span class="token operator">+</span> <span class="token string">&quot;/access-token&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="handling-refresh-tokens-expiring" tabindex="-1">Handling Refresh Tokens Expiring <a class="header-anchor" href="#handling-refresh-tokens-expiring" aria-hidden="true">#</a></h3><p>For the case when Refresh Tokens themselves expire the <code>WebServiceException</code> is wrapped in a typed <code>RefreshTokenException</code> to make it easier to handle initiating the flow to re-authenticate the User, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">try</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RefreshTokenException</span> ex<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// re-authenticate to get new RefreshToken</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="lifetimes-of-tokens" tabindex="-1">Lifetimes of tokens <a class="header-anchor" href="#lifetimes-of-tokens" aria-hidden="true">#</a></h3><p>The default expiry time of JWT and Refresh Tokens below can be overridden when registering the <code>JwtAuthProvider</code>:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span> <span class="token punctuation">{</span>
    ExpireTokensIn        <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromDays</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// JWT Token Expiry</span>
    ExpireRefreshTokensIn <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromDays</span><span class="token punctuation">(</span><span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Refresh Token Expiry</span>
<span class="token punctuation">}</span>
</code></pre></div><p>These expiry times are use-case specific so you&#39;ll want to check what values are appropriate for your System. The <code>ExpireTokensIn</code> property controls how long a client is allowed to make Authenticated Requests with the same JWT Token, whilst the <code>ExpireRefreshTokensIn</code> property controls how long the client can keep requesting new JWT Tokens using the same Refresh Token before needing to re-authenticate and generate a new one.</p><h4 id="requires-user-auth-repository-or-iusersessionsourceasync" tabindex="-1">Requires User Auth Repository or IUserSessionSourceAsync <a class="header-anchor" href="#requires-user-auth-repository-or-iusersessionsourceasync" aria-hidden="true">#</a></h4><p>One limitation for Refresh Tokens support is that it must be configured to use a <a href="/authentication-and-authorization#user-auth-repository">User Auth Repository</a> which is the persisted data source used to rehydrate the User Session that&#39;s embedded in the JWT Token.</p><p>Users who are not using an <code>IAuthRepository</code> can instead implement the <code>IUserSessionSourceAsync</code> interface:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserSessionSourceAsync</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IAuthSession<span class="token punctuation">&gt;</span></span> <span class="token function">GetUserSessionAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> userAuthId<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> token<span class="token operator">=</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>On either their <strong>Custom AuthProvider</strong>, or if preferred register it as a <strong>dependency in the IOC</strong> as an alternative source for populating Sessions in new JWT Tokens created using RefreshToken&#39;s. The implementation should only return a populated <code>IAuthSession</code> if the User is allowed to sign-in, e.g. if their account is locked or suspended it should throw an Exception:</p><div class="language-csharp"><pre><code><span class="token keyword">throw</span> HttpError<span class="token punctuation">.</span><span class="token function">Forbidden</span><span class="token punctuation">(</span><span class="token string">&quot;User is suspended&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="convert-sessions-to-tokens" tabindex="-1">Convert Sessions to Tokens <a class="header-anchor" href="#convert-sessions-to-tokens" aria-hidden="true">#</a></h3><p>Another useful Service that <code>JwtAuthProvider</code> provides is being able to Convert your current Authenticated Session into a Token. Authenticating via Credentials Auth establishes an <strong>Authenticated Session</strong> with the server which is captured in the <a href="/sessions#cookie-session-ids">Session Cookies</a> that gets populated on the HTTP Client. This lets us access protected Services immediately after we&#39;ve successfully Authenticated, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> authResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span> <span class="token punctuation">{</span>
    provider <span class="token operator">=</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span>
    UserName <span class="token operator">=</span> username<span class="token punctuation">,</span>
    Password <span class="token operator">=</span> password
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="request-jwt-cookie-is-set-on-authentication" tabindex="-1">Request JWT Cookie is set on Authentication <a class="header-anchor" href="#request-jwt-cookie-is-set-on-authentication" aria-hidden="true">#</a></h3><p>However this only establishes an <strong>Authenticated Session</strong> to a single Server that only lasts until the session stored on the Server is valid. The easiest way to tell ServiceStack to convert the Session into a stateless JWT Cookie instead is to set the <code>UseTokenCookie</code> option when authenticating, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> authResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span> <span class="token punctuation">{</span>
    provider <span class="token operator">=</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span>
    UserName <span class="token operator">=</span> username<span class="token punctuation">,</span>
    Password <span class="token operator">=</span> password<span class="token punctuation">,</span>
    UseTokenCookie <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Uses stateless ss-tok Cookie with our Session encapsulated in JWT Token</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name"><span class="token keyword">var</span></span> jwtToken <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetTokenCookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//From ss-tok Cookie</span>
</code></pre></div><p>This also removes the our Session from the App Servers Cache as now the Users <strong>Authenticated Session</strong> is contained solely in the JWT Cookie and is valid until the JWT Cookies Expiration, instead of determined by Server Session State.</p><h3 id="server-token-cookies" tabindex="-1">Server Token Cookies <a class="header-anchor" href="#server-token-cookies" aria-hidden="true">#</a></h3><p>In most cases the easiest way to utilize JWT with your other Auth Providers is to configure <code>JwtAuthProvider</code> to use <code>UseTokenCookie</code> to automatically return a JWT Token Cookie for all Auth Providers authenticating via <code>Authenticate</code> requests or after a successful OAuth Web Flow from an <a href="/authentication-and-authorization#oauth-providers">OAuth Provider</a>.</p><p>This is what <a href="https://techstacks.io" target="_blank" rel="noopener noreferrer">techstacks.io</a> uses to maintain Authentication via a JWT Token after Signing in with Twitter or GitHub:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthFeature</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomUserSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IAuthProvider<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TwitterAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GithubAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span><span class="token punctuation">,</span>    
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            UseTokenCookie <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Clients can then detect whether a user is authenticated by sending an empty <code>Authenticate</code> request which either returns a <code>AuthenticateResponse</code> DTO containing basic Session Info for authenticated requests otherwise throws a <strong>401 Unauthorized</strong> response.</p><p>So clients will be able to detect whether a user is authenticated with something like:</p><div class="language-ts"><pre><code><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">isAuthenticated</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">await</span> <span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">//...</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// User is authenticated</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="converting-an-existing-authenticated-session-into-a-jwt-token" tabindex="-1">Converting an existing Authenticated Session into A JWT Token <a class="header-anchor" href="#converting-an-existing-authenticated-session-into-a-jwt-token" aria-hidden="true">#</a></h3><p>Another way we can access our Token is to call the <code>ConvertSessionToToken</code> Service which also converts our currently Authenticated Session into a JWT Token which we can use instead to communicate with all our independent Services, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> tokenResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConvertSessionToToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> jwtToken <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetTokenCookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//From ss-tok Cookie</span>

<span class="token class-name"><span class="token keyword">var</span></span> client2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>service2BaseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span> BearerToken <span class="token operator">=</span> jwtToken <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client2<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured2</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> client3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>service3BaseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span> BearerToken <span class="token operator">=</span> jwtToken <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client3<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured3</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Tokens are returned in the Secure HttpOnly <strong>ss-tok</strong> Cookie, accessible from the <code>GetTokenCookie()</code> extension method as seen above.</p><p>The default behavior of <code>ConvertSessionToToken</code> is to remove the Current Session from the Auth Server which will prevent access to protected Services using our previously Authenticated Session. If you still want to preserve your existing Session you can indicate this with:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> tokenResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConvertSessionToToken</span> <span class="token punctuation">{</span> PreserveSession <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For cases where you don&#39;t have access to HTTP Client Cookies you can use the new opt-in <code>IncludeJwtInConvertSessionToTokenResponse</code> option on <code>JwtAuthProvider</code> to also include the JWT in <code>AccessToken</code> property of <code>ConvertSessionToTokenResponse</code> Responses which are otherwise only available in the <code>ss-tok</code> Cookie.</p><h3 id="ajax-clients" tabindex="-1">Ajax Clients <a class="header-anchor" href="#ajax-clients" aria-hidden="true">#</a></h3><p>Using Cookies is the <a href="https://stormpath.com/blog/where-to-store-your-jwts-cookies-vs-html5-web-storage" target="_blank" rel="noopener noreferrer">recommended way for using JWT Tokens in Web Applications</a> since the <code>HttpOnly</code> Cookie flag will prevent it from being accessible from JavaScript making them immune to XSS attacks whilst the <code>Secure</code> flag will ensure that the JWT Token is only ever transmitted over HTTPS.</p><p>You can convert your Session into a Token and set the <strong>ss-tok</strong> Cookie in your web page by sending an Ajax request to <code>/session-to-token</code>, e.g:</p><div class="language-javascript"><pre><code>$<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/session-to-token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Likewise this API lets you convert Sessions created by any of the OAuth providers into a stateless JWT Token.</p><h3 id="switching-existing-sites-to-jwt" tabindex="-1">Switching existing Sites to JWT <a class="header-anchor" href="#switching-existing-sites-to-jwt" aria-hidden="true">#</a></h3><p>Existing sites that already have an <a href="/sessions">Authenticated Session</a> can convert their current server Session into a JWT Token by sending a <code>ConvertSessionToToken</code> Request DTO or an empty <strong>POST</strong> request to its <code>/session-to-token</code> user-defined route:</p><div class="language-ts"><pre><code><span class="token keyword">const</span> authResponse <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConvertSessionToToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>E.g. Single Page App can call this when their Web App is first loaded, which is ignored if the User isn&#39;t authenticated but if the Web App is loaded after <a href="https://docs.servicestack.net/authentication-and-authorization#oauth-providers" target="_blank" rel="noopener noreferrer">Signing In via an OAuth Provider</a> it will convert their OAuth Authenticated Session into a stateless client JWT Token Cookie.</p><p>This approach is also used by the old Angular TechStacks <a href="http://angular.techstacks.io" target="_blank" rel="noopener noreferrer">angular.techstacks.io</a> after signing in via Twitter and Github OAuth to <a href="https://github.com/ServiceStackApps/TechStacks/blob/78ecd5e390e585c14f616bb27b24e0072b756040/src/TechStacks/TechStacks/js/user/services.js#L30" target="_blank" rel="noopener noreferrer">use JWT with a single jQuery Ajax call</a>:</p><div class="language-javascript"><pre><code>$<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/session-to-token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Whilst <a href="https://github.com/ServiceStack/Gistlyn/blob/770768e7f7f6a7258ea948dbe1cee7f09b47ea8d/src/Gistlyn/src/app.tsx#L69" target="_blank" rel="noopener noreferrer">Gistlyn uses the Fetch API</a> to convert an existing Github OAuth into a JWT Token Cookie:</p><div class="language-ts"><pre><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/session-to-token&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> method<span class="token operator">:</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> credentials<span class="token operator">:</span><span class="token string">&quot;include&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We&#39;ve also upgraded <a href="https://servicestack.net" target="_blank" rel="noopener noreferrer">servicestack.net</a> which as it uses normal Username/Password Credentials Authentication (i.e. instead of redirects in OAuth), it doesn&#39;t need any additional network calls as we can add the <code>UseTokenCookie</code> option as a hidden variable in our FORM request:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-login<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/auth/login<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UseTokenCookie<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Which just like <code>ConvertSessionToToken</code> returns a populated session in the <strong>ss-tok</strong> Cookie so now both <a href="https://techstacks.io" target="_blank" rel="noopener noreferrer">techstacks.io</a> and <a href="https://servicestack.net" target="_blank" rel="noopener noreferrer">servicestack.net</a> can maintain uninterrupted Sessions across multiple redeployments without a persistent Sessions cache.</p><h3 id="fallback-auth-and-rsa-keys" tabindex="-1">Fallback Auth and RSA Keys <a class="header-anchor" href="#fallback-auth-and-rsa-keys" aria-hidden="true">#</a></h3><p>You can specify multiple fallback AES Auth Keys and RSA Public Keys to allow for smooth key rotations to newer Auth Keys whilst simultaneously being able to verify JWT Tokens signed with a previous key.</p><p>The fallback keys can be configured in code when registering the <code>JwtAuthProvider</code>:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span> <span class="token punctuation">{</span>
    AuthKey <span class="token operator">=</span> authKey2016<span class="token punctuation">,</span>
    FallbackAuthKeys <span class="token operator">=</span> <span class="token punctuation">{</span>
        authKey2015<span class="token punctuation">,</span>
        authKey2014<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    PrivateKey <span class="token operator">=</span> privateKey2016<span class="token punctuation">,</span>
    FallbackPublicKeys <span class="token operator">=</span> <span class="token punctuation">{</span>
        publicKey2015<span class="token punctuation">,</span>
        publicKey2014<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Or in <a href="/appsettings">AppSettings</a>:</p><div class="language-xml"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appSettings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jwt.AuthKeyBase64<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{AuthKey2016Base64}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jwt.AuthKeyBase64.1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{AuthKey2015Base64}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jwt.AuthKeyBase64.2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{AuthKey2014Base64}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jwt.PrivateKeyXml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{PrivateKey2016Xml}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jwt.PublicKeyXml.1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{PublicKeyXml2015Xml}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jwt.PublicKeyXml.2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{PublicKeyXml2014Xml}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appSettings</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="send-jwts-in-http-params" tabindex="-1">Send JWTs in HTTP Params <a class="header-anchor" href="#send-jwts-in-http-params" aria-hidden="true">#</a></h3><p>The JWT Auth Provider can <strong>opt-in</strong> to accept JWT&#39;s via the Query String or HTML POST FormData with:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span> <span class="token punctuation">{</span>
    AllowInQueryString <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    AllowInFormData <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This is useful for situations where it&#39;s not possible to attach the JWT in the HTTP Request Headers or <code>ss-tok</code> Cookie.</p><p>For example if you wanted to authenticate via JWT to a real-time <a href="/server-events">Server Events stream</a> from a token retrieved from a remote auth server (i.e. so the JWT Cookie isn&#39;t already configured with the SSE server) you can <a href="/jwt-authprovider#ajax-clients">call the /session-to-token API</a> to convert the JWT Bearer Token into a JWT Cookie which will configure it with that domain so the subsequent HTTP Requests to the SSE event stream contains the JWT cookie and establishes an authenticated session:</p><div class="language-ts"><pre><code><span class="token keyword">var</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">setBearerToken</span><span class="token punctuation">(</span><span class="token constant">JWT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConvertSessionToToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> sseClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerEventsClient</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    handlers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">onConnect</span><span class="token operator">:</span> e <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>isAuthenticated <span class="token comment">/*true*/</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>userId<span class="token punctuation">,</span> e<span class="token punctuation">.</span>displayName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Unfortunately this wont work in <code>node.exe</code> Server Apps (or in integration tests) which doesn&#39;t support a central location for configuring domain cookies. One solution that works everywhere is to add the JWT to the <code>?ss-tok</code> query string that&#39;s used to connect to the <code>/event-stream</code> URL, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> sseClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ServerEventsClient</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    resolveStreamUrl<span class="token punctuation">:</span> url <span class="token operator">=&gt;</span> <span class="token function">appendQueryString</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;ss-tok&quot;</span><span class="token punctuation">:</span> JWT <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">handlers</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        onConnect<span class="token punctuation">:</span> e <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>isAuthenticated <span class="token comment">/*true*/</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>userId<span class="token punctuation">,</span> e<span class="token punctuation">.</span>displayName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="setting-the-jwt-token-cookie" tabindex="-1">Setting the JWT Token Cookie <a class="header-anchor" href="#setting-the-jwt-token-cookie" aria-hidden="true">#</a></h4><p>As the TypeScript <code>ServerEventsClient</code> needs to use the browsers native EventSource class to establish the SSE connection it&#39;s not able to customize the HTTP Request Headers in other clients but as the client shares the same cookies with the browser you can use a JWT Token Cookie either by Requesting to use a <a href="/jwt-authprovider#request-jwt-cookie-is-set-on-authentication">JWT Token Cookie at Authentication</a> or by setting the Token Cookie on the client, <a href="/corsfeature">CORS permitting</a>, e.g:</p><div class="language-js"><pre><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;ss-tok={Token}&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="jwt-formdata-post" tabindex="-1">JWT FormData POST <a class="header-anchor" href="#jwt-formdata-post" aria-hidden="true">#</a></h4><p>The stateless nature of JWTs makes it highly versatile to be able to use in a number of difference scenarios, e.g. it could be used to make stateless authenticated requests across different domains without JavaScript (HTTP Headers or Cookies), by embedding it in a HTML Form POST:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://remote.org/secure<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ss-tok<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{JWT}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Although as this enables cross-domain posts it should be enabled with great care.</p><h4 id="runtime-jwt-configuration" tabindex="-1">Runtime JWT Configuration <a class="header-anchor" href="#runtime-jwt-configuration" aria-hidden="true">#</a></h4><p>To allow for dynamic per request configuration as needed in Multi Tenant applications we&#39;ve added a new <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Configuration/IAppSettings.cs" target="_blank" rel="noopener noreferrer">IRuntimeAppSettings</a> API which can be registered in your <code>AppHost</code> to return custom per request configuration.</p><p>E.g. this can be used to return a custom <code>AuthKey</code> that should be used to sign JWT Tokens for that request:</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IRuntimeAppSettings<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RuntimeAppSettings</span> <span class="token punctuation">{</span> 
    Settings <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>JwtAuthProvider<span class="token punctuation">.</span>AuthKey<span class="token punctuation">)</span><span class="token punctuation">,</span> req <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">GetAuthKey</span><span class="token punctuation">(</span><span class="token function">GetTenantId</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The following <code>JwtAuthProvider</code> properties can be overridden by <code>IRuntimeAppSettings</code>:</p><ul><li><code>byte[]</code> AuthKey</li><li><code>RSAParameters</code> PrivateKey</li><li><code>RSAParameters</code> PublicKey</li><li><code>List&lt;byte[]&gt;</code> FallbackAuthKeys</li><li><code>List&lt;RSAParameters&gt;</code> FallbackPublicKeys</li></ul><h3 id="multiple-audiences" tabindex="-1">Multiple Audiences <a class="header-anchor" href="#multiple-audiences" aria-hidden="true">#</a></h3><p>With the JWT support for issuing and validating JWT&#39;s with multiple audiences, you could for example configure the JWT Auth Provider to issue tokens allowing users to access <strong>search</strong> and <strong>analytics</strong> system functions by configuring its <code>Audiences</code> property:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span> <span class="token punctuation">{</span>
    Audiences <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;search&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;analytics&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This will include both audiences in new JWT&#39;s as a JSON Array (if only 1 audience was configured it will continue to be embedded as a string).</p><p>When validating a JWT with multiple audiences it only needs to match a single Audience configured with the <code>JwtAuthProvider</code>, e.g given the above configuration users that authenticate with a JWT containing:</p><div class="language-"><pre><code>JWT[aud] = null           //= Valid: No Audience specified
JWT[aud] = admin          //= NOT Valid: Wrong Audience specified
JWT[aud] = [search,admin] //= Valid: Partial Audience match
</code></pre></div><h2 id="adhoc-jwt-apis" tabindex="-1">Adhoc JWT APIs <a class="header-anchor" href="#adhoc-jwt-apis" aria-hidden="true">#</a></h2><p>You can retrieve the JWT Token string from the current <code>IRequest</code> with:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">string</span></span> jwt <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">GetJwtToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can manually convert JWT Tokens into User Sessions with:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> userSession <span class="token operator">=</span> JwtAuthProviderReader<span class="token punctuation">.</span><span class="token function">CreateSessionFromJwt</span><span class="token punctuation">(</span><span class="token keyword">base</span><span class="token punctuation">.</span>Request<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Which is essentially a shorthand for:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> jwtProvider <span class="token operator">=</span> AuthenticateService<span class="token punctuation">.</span><span class="token function">GetJwtAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> userSession <span class="token operator">=</span> jwtProvider<span class="token punctuation">.</span><span class="token function">ConvertJwtToSession</span><span class="token punctuation">(</span><span class="token keyword">base</span><span class="token punctuation">.</span>Request<span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token function">GetJwtToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="creating-jwt-tokens-manually" tabindex="-1">Creating JWT Tokens Manually <a class="header-anchor" href="#creating-jwt-tokens-manually" aria-hidden="true">#</a></h3><p>You can create a custom JWT Token that encapsulates an Authenticated User Session by using JwtAuthProvider&#39;s static APIs to create the JWT Header, JWT Payload then sign and authenticate the token using the configured signing keys in order to make authenticated Requests to any remote AppHost configured with the same JwtAuthProvider configuration, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> jwtProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> header <span class="token operator">=</span> JwtAuthProvider<span class="token punctuation">.</span><span class="token function">CreateJwtHeader</span><span class="token punctuation">(</span>jwtProvider<span class="token punctuation">.</span>HashAlgorithm<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> body <span class="token operator">=</span> JwtAuthProvider<span class="token punctuation">.</span><span class="token function">CreateJwtPayload</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthUserSession</span>
    <span class="token punctuation">{</span>
        UserAuthId <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
        DisplayName <span class="token operator">=</span> <span class="token string">&quot;Test&quot;</span><span class="token punctuation">,</span>
        Email <span class="token operator">=</span> <span class="token string">&quot;as@if.com&quot;</span><span class="token punctuation">,</span>
        IsAuthenticated <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">issuer</span><span class="token punctuation">:</span> jwtProvider<span class="token punctuation">.</span>Issuer<span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">expireIn</span><span class="token punctuation">:</span> jwtProvider<span class="token punctuation">.</span>ExpireTokensIn<span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">audience</span><span class="token punctuation">:</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span> jwtProvider<span class="token punctuation">.</span>Audience <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">roles</span><span class="token punctuation">:</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;TheRole&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">permissions</span><span class="token punctuation">:</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;ThePermission&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> jwtToken <span class="token operator">=</span> JwtAuthProvider<span class="token punctuation">.</span><span class="token function">CreateJwt</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span> body<span class="token punctuation">,</span> jwtProvider<span class="token punctuation">.</span><span class="token function">GetHashAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The generated JWT Token can then be <a href="#sending-jwt-with-service-clients">used to make Authenticated Requests</a> to any Server configured with the same JwtAuthProvider configuration that the JWT Token was created with, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">SetTokenCookie</span><span class="token punctuation">(</span>jwtToken<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="validating-jwt-manually" tabindex="-1">Validating JWT Manually <a class="header-anchor" href="#validating-jwt-manually" aria-hidden="true">#</a></h3><p>The <code>IsValidJwt()</code> and <code>GetValidJwtPayload()</code> APIs lets you validate and inspect the contents of a JWT stand-alone, i.e. outside the context of a Request. Given an invalid <code>expiredJwt</code> and a <code>validJwt</code> you can test the validity and inspect the contents of each with:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> jwtProvider <span class="token operator">=</span> AuthenticateService<span class="token punctuation">.</span><span class="token function">GetJwtAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

jwtProvider<span class="token punctuation">.</span><span class="token function">IsValidJwt</span><span class="token punctuation">(</span>expiredJwt<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">//= false</span>
jwtProvider<span class="token punctuation">.</span><span class="token function">GetValidJwtPayload</span><span class="token punctuation">(</span>expiredJwt<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//= null</span>


jwtProvider<span class="token punctuation">.</span><span class="token function">IsValidJwt</span><span class="token punctuation">(</span>validJwt<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//= true</span>
<span class="token class-name">JsonObject</span> payload <span class="token operator">=</span> jwtProvider<span class="token punctuation">.</span><span class="token function">GetValidJwtPayload</span><span class="token punctuation">(</span>validJwt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> userId <span class="token operator">=</span> payload<span class="token punctuation">[</span><span class="token string">&quot;sub&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="large-profile-image-handling" tabindex="-1">Large Profile Image Handling <a class="header-anchor" href="#large-profile-image-handling" aria-hidden="true">#</a></h3><p>As <a href="/releases/v6.html#microsoft-graph-auth">high res profile images in Microsoft Graph Auth</a> doesn&#39;t return CDN URIs to the users profile image that can be referenced within Apps directly, it pushes the burden of profile image management down to every authenticating App server, which to maintain their <strong>statelessness</strong>, means converting into a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" target="_blank" rel="noopener noreferrer">Data URI</a>, except as it typically returns the high-res image JPEG which far exceeds the maximum <strong>4kb</strong> limit of cookies, it requires resizing in order to make fit (otherwise the JWT Cookie is ignored and Authentication will fail).</p><p>Unfortunately as <a href="/releases/v6.html#state-of-imaging-on-linux">Image Resizing is unreliable in Linux</a> we&#39;ve had to adopt an alternative solution that&#39;s able to display a users high-res photo whilst still keeping our App server stateless by creating a new <a href="https://github.com/ServiceStack/ServiceStack/blob/main/ServiceStack/src/ServiceStack/ImagesHandler.cs" target="_blank" rel="noopener noreferrer">ImagesHandler</a> that the JWT AuthProvider calls <code>RewriteImageUri()</code> on to replace any large profile URLs with a link to its <code>/auth-profiles/{MD5}.jpg</code> - a URL it also handles serving the original high-res image back to.</p><p>This is the solution <code>AuthFeature</code> uses by default, pre-configured with:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthFeature</span> <span class="token punctuation">{</span>
    ProfileImages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ImagesHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/auth-profiles&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">fallback</span><span class="token punctuation">:</span> Svg<span class="token punctuation">.</span><span class="token function">GetStaticContent</span><span class="token punctuation">(</span>Svg<span class="token punctuation">.</span>Icons<span class="token punctuation">.</span>DefaultProfile<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Where if using a custom <a href="https://github.com/NetCoreTemplates/blazor-wasm/blob/main/MyApp/appsettings.Development.json#L30" target="_blank" rel="noopener noreferrer">SavePhotoSize</a> will be resized using Microsoft Graph APIs, if the resized image size still exceeds the max allowable size in JWT Cookies it&#39;s swapped out for a URL reference to the image which ImageHandler stores in memory. The trade-off of this default is when your Docker App is re-deployed, whilst their stateless authentication keeps them authenticated, the original high-res photo saved in ImageHandler&#39;s memory will be lost, which will be replaced with the fallback <code>Svg.Icons.DefaultProfile</code> image.</p><p>Using an MD5 hash does allow us to maintain URLs that&#39;s both predictable in that it will result in the same hash after every sign in, while also preventing information leakage that using a predictable User Id would do. A client-only solution that could retain their avatar across deployments is saving it to localStorage however that pushes the burden down to every client App using your APIs, which could be manageable if you control all of them.</p><h4 id="persistent-large-profile-image-handling" tabindex="-1">Persistent Large Profile Image Handling <a class="header-anchor" href="#persistent-large-profile-image-handling" aria-hidden="true">#</a></h4><p>For a persistent solution that retains profile images across deployments you can use <code>PersistentImagesHandler</code> with the VFS Provider and path for profile images to be written to, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthFeature</span> <span class="token punctuation">{</span>
    ProfileImages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PersistentImagesHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/auth-profiles&quot;</span><span class="token punctuation">,</span> Svg<span class="token punctuation">.</span><span class="token function">GetStaticContent</span><span class="token punctuation">(</span>Svg<span class="token punctuation">.</span>Icons<span class="token punctuation">.</span>DefaultProfile<span class="token punctuation">)</span><span class="token punctuation">,</span>
        appHost<span class="token punctuation">.</span>VirtualFiles<span class="token punctuation">,</span> <span class="token string">&quot;/App_Data/auth-profiles&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When using the default <code>FileSystemVirtualFiles</code> VFS provider this would require configuring your Docker App with a persistent <code>/App_Data</code> Volume, otherwise using one of the other <a href="/virtual-file-system">Virtual Files Providers</a> like <code>S3VirtualFiles</code> or <code>AzureBlobVirtualFiles</code> may be the more preferable solution to keep your Docker Apps stateless.</p><h3 id="refresh-token-cookies-supported-in-all-service-clients" tabindex="-1">Refresh Token Cookies supported in all Service Clients <a class="header-anchor" href="#refresh-token-cookies-supported-in-all-service-clients" aria-hidden="true">#</a></h3><p><div><p>JWT first-class support for Refresh Token Cookies is implicitly enabled when configuring the <code>JwtAuthProvider</code> which uses <a href="/jwt-authprovider.html#jwt-token-cookies">JWT Token Cookies</a> by default which upon authentication will return the Refresh Token in a <code>ss-reftok</code> <strong>Secure</strong>, <strong>HttpOnly</strong> Cookie alongside the Users stateless Authenticated UserSession in the JWT <code>ss-tok</code> Cookie.</p><p>This supports <a href="/jwt-authprovider.html#transparent-server-auto-refresh-of-jwt-tokens">transparently auto refreshing access tokens</a> in HTTP Clients by default as the server will rotate JWT Access Token Cookies which expire before the Refresh Token expiration.</p><p>The alternative configuration of using explicit JWT Bearer Tokens is also supported in all smart, generic Service Clients for all <a href="/add-servicestack-reference">Add ServiceStack Reference</a> languages which enable a nicer (i.e. maintenance-free) development experience with all Service Clients automatically supports fetching new JWT Bearer Tokens &amp; transparently Auto Retry Requests on <strong>401 Unauthorized</strong> responses:</p><h4 id="c-f-vb-net-service-clients" tabindex="-1">C#, F# &amp; VB .NET Service Clients <a class="header-anchor" href="#c-f-vb-net-service-clients" aria-hidden="true">#</a></h4><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> authRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span> <span class="token punctuation">{</span>
    provider <span class="token operator">=</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span>
    UserName <span class="token operator">=</span> userName<span class="token punctuation">,</span>
    Password <span class="token operator">=</span> password<span class="token punctuation">,</span>
    RememberMe <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> authResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span>authRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//client.GetTokenCookie();        // JWT Bearer Token</span>
<span class="token comment">//client.GetRefreshTokenCookie(); // JWT Refresh Token</span>

<span class="token comment">// When no longer valid, Auto Refreshes JWT Bearer Token using Refresh Token Cookie</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SecureRequest</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

Inspect<span class="token punctuation">.</span><span class="token function">printDump</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// print API Response into human-readable format (alias: `response.PrintDump()`)</span>
</code></pre></div><h4 id="typescript-js-service-client" tabindex="-1">TypeScript &amp; JS Service Client <a class="header-anchor" href="#typescript-js-service-client" aria-hidden="true">#</a></h4><div class="language-ts"><pre><code><span class="token keyword">let</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> authRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>provider<span class="token operator">:</span><span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span>userName<span class="token punctuation">,</span>password<span class="token punctuation">,</span>rememberMe<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> authResponse <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>authRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// In Browser can&#39;t read &quot;HttpOnly&quot; Token Cookies by design, In Node.js can access client.cookies  </span>

<span class="token comment">// When no longer valid, Auto Refreshes JWT Bearer Token using Refresh Token Cookie</span>
<span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SecureRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Inspect<span class="token punctuation">.</span><span class="token function">printDump</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// print API Response into human-readable format</span>
</code></pre></div><h4 id="python-service-client" tabindex="-1">Python Service Client <a class="header-anchor" href="#python-service-client" aria-hidden="true">#</a></h4><div class="language-python"><pre><code>client <span class="token operator">=</span> JsonServiceClient<span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span>
authRequest <span class="token operator">=</span> Authenticate<span class="token punctuation">(</span>
    provider<span class="token operator">=</span><span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span> user_name<span class="token operator">=</span>user_name<span class="token punctuation">,</span> password<span class="token operator">=</span>password<span class="token punctuation">,</span> rememberMe<span class="token operator">=</span>true<span class="token punctuation">)</span>
authResponse <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span>authRequest<span class="token punctuation">)</span>

<span class="token comment"># When no longer valid, Auto Refreshes JWT Bearer Token using Refresh Token Cookie</span>
response <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span>SecureRequest<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#client.token_cookie         # JWT Bearer Token</span>
<span class="token comment">#client.refresh_token_cookie # JWT Refresh Token</span>

printdump<span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token comment"># print API Response into human-readable format</span>
</code></pre></div><h4 id="dart-service-clients" tabindex="-1">Dart Service Clients <a class="header-anchor" href="#dart-service-clients" aria-hidden="true">#</a></h4><div class="language-dart"><pre><code><span class="token keyword">var</span> client <span class="token operator">=</span> <span class="token class-name">ClientFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> authRequest <span class="token operator">=</span> <span class="token class-name">Authenticate</span><span class="token punctuation">(</span>provider<span class="token punctuation">:</span><span class="token string-literal"><span class="token string">&quot;credentials&quot;</span></span><span class="token punctuation">,</span> userName<span class="token punctuation">:</span>userName<span class="token punctuation">,</span> password<span class="token punctuation">:</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> authResponse <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>authRequest<span class="token punctuation">)</span>

<span class="token comment">//client.getTokenCookie()        // JWT Bearer Token</span>
<span class="token comment">//client.getRefreshTokenCookie() // JWT Refresh Token</span>

<span class="token comment">// When no longer valid, Auto Refreshes JWT Bearer Token using Refresh Token Cookie</span>
<span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token class-name">SecureRequest</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span><span class="token string-literal"><span class="token string">&quot;World&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Inspect</span><span class="token punctuation">.</span><span class="token function">printDump</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// print API Response into human-readable format</span>
</code></pre></div><h4 id="java-service-clients" tabindex="-1">Java Service Clients <a class="header-anchor" href="#java-service-clients" aria-hidden="true">#</a></h4><div class="language-java"><pre><code><span class="token class-name">JsonServiceClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Authenticate</span> authRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setProvider</span><span class="token punctuation">(</span><span class="token string">&quot;credentials&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setRememberMe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">AuthenticateResponse</span> authResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>authRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//client.getTokenCookie();         // JWT Bearer Token</span>
<span class="token comment">//client.getRefreshTokenCookie();  // JWT Refresh Token</span>

<span class="token comment">// When no longer valid, Auto Refreshes JWT Bearer Token using Refresh Token Cookie</span>
<span class="token class-name">SecureResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SecureRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Inspect</span><span class="token punctuation">.</span><span class="token function">printDump</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// print API Response into human-readable format</span>
</code></pre></div><h4 id="kotlin-service-clients" tabindex="-1">Kotlin Service Clients <a class="header-anchor" href="#kotlin-service-clients" aria-hidden="true">#</a></h4><div class="language-kotlin"><pre><code><span class="token keyword">val</span> client <span class="token operator">=</span> new <span class="token function">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span>
<span class="token keyword">val</span> authResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token function">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
    provider <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;credentials&quot;</span></span>
    userName <span class="token operator">=</span> userName
    password <span class="token operator">=</span> password
    rememberMe <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//client.tokenCookie         // JWT Bearer Token</span>
<span class="token comment">//client.refreshTokenCookie  // JWT Refresh Token</span>

<span class="token comment">// When no longer valid, Auto Refreshes JWT Bearer Token using Refresh Token Cookie</span>
<span class="token keyword">val</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token function">SecureRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
    name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;World&quot;</span></span>    
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Inspect<span class="token punctuation">.</span><span class="token function">printDump</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token comment">// print API Response into human-readable format</span>
</code></pre></div><h4 id="swift-service-client" tabindex="-1">Swift Service Client <a class="header-anchor" href="#swift-service-client" aria-hidden="true">#</a></h4><div class="language-swift"><pre><code><span class="token keyword">let</span> client <span class="token operator">=</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">:</span> baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> authRequest <span class="token operator">=</span> <span class="token class-name">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
authRequest<span class="token punctuation">.</span>provider <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;credentials&quot;</span></span>
authRequest<span class="token punctuation">.</span>userName <span class="token operator">=</span> userName
authRequest<span class="token punctuation">.</span>password <span class="token operator">=</span> password
authRequest<span class="token punctuation">.</span>rememberMe <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">let</span> authResponse <span class="token operator">=</span> <span class="token keyword">try</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>authRequest<span class="token punctuation">)</span>

<span class="token comment">//client.getTokenCookie()        // JWT Bearer Token</span>
<span class="token comment">//client.getRefreshTokenCookie() // JWT Refresh Token</span>

<span class="token comment">// When no longer valid, Auto Refreshes JWT Bearer Token using Refresh Token Cookie</span>
<span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token class-name">SecureRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
request<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;World&quot;</span></span>
<span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">try</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>

<span class="token class-name">Inspect</span><span class="token punctuation">.</span><span class="token function">printDump</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token comment">// print API Response into human-readable format</span>
</code></pre></div></div></p><h2 id="jwt-configuration" tabindex="-1">JWT Configuration <a class="header-anchor" href="#jwt-configuration" aria-hidden="true">#</a></h2><p>The JWT Auth Provider provides the following options to customize its behavior:</p><div class="language-csharp"><pre><code><span class="token keyword">class</span> <span class="token class-name">JwtAuthProviderReader</span>
<span class="token punctuation">{</span>
    <span class="token comment">// The RSA Bit Key Length to use</span>
    <span class="token keyword">static</span> <span class="token class-name">RsaKeyLengths</span> UseRsaKeyLength <span class="token operator">=</span> RsaKeyLengths<span class="token punctuation">.</span>Bit2048

    <span class="token comment">// Different HMAC Algorithms supported</span>
    Dictionary<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Func<span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span> HmacAlgorithms

    <span class="token comment">// Different RSA Signing Algorithms supported</span>
    Dictionary<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Func<span class="token operator">&lt;</span>RSAParameters<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span> RsaSignAlgorithms
    Dictionary<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Func<span class="token operator">&lt;</span>RSAParameters<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;&gt;</span> RsaVerifyAlgorithms

    <span class="token comment">// Whether to only allow access via API Key from a secure connection. (default true)</span>
    <span class="token keyword">bool</span> RequireSecureConnection

    <span class="token comment">// Run custom filter after JWT Header is created</span>
    Action<span class="token operator">&lt;</span>JsonObject<span class="token punctuation">,</span> IAuthSession<span class="token operator">&gt;</span> CreateHeaderFilter

    <span class="token comment">// Run custom filter after JWT Payload is created</span>
    Action<span class="token operator">&lt;</span>JsonObject<span class="token punctuation">,</span> IAuthSession<span class="token operator">&gt;</span> CreatePayloadFilter

    <span class="token comment">// Run custom filter after session is restored from a JWT Token</span>
    Action<span class="token operator">&lt;</span>IAuthSession<span class="token punctuation">,</span> JsonObject<span class="token punctuation">,</span> IRequest<span class="token operator">&gt;</span> PopulateSessionFilter

    <span class="token comment">// Whether to encrypt JWE Payload (default false). </span>
    <span class="token comment">// Uses RSA-OAEP for Key Encryption and AES/128/CBC HMAC SHA256 for Content Encryption</span>
    <span class="token keyword">bool</span> EncryptPayload

    <span class="token comment">// Which Hash Algorithm should be used to sign the JWT Token. (default HS256)</span>
    <span class="token keyword">string</span> HashAlgorithm

    <span class="token comment">// Whether to only allow processing of JWT Tokens using the configured HashAlgorithm.</span>
    <span class="token keyword">bool</span> RequireHashAlgorithm

    <span class="token comment">// The Issuer to embed in the token. (default ssjwt)</span>
    <span class="token keyword">string</span> Issuer

    <span class="token comment">// The Audience to embed in the token. (default null)</span>
    <span class="token keyword">string</span> Audience

    <span class="token comment">// What Id to use to identify the Key used to sign the token. (3 chars of Base64 Key)</span>
    <span class="token keyword">string</span> KeyId

    <span class="token comment">// The AuthKey used to sign the JWT Token</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> AuthKey
    <span class="token comment">// Convenient overload to initialize AuthKey with Base64 string</span>
    <span class="token keyword">string</span> AuthKeyBase64

    <span class="token comment">// The RSA Private Key used to Sign the JWT Token when RSA is used</span>
    RSAParameters<span class="token punctuation">?</span> PrivateKey
    <span class="token comment">// Convenient overload to initialize the Private Key via exported XML</span>
    <span class="token keyword">string</span> PrivateKeyXml

    <span class="token comment">// The RSA Public Key used to Verify the JWT Token when RSA is used</span>
    RSAParameters<span class="token punctuation">?</span> PublicKey

    <span class="token comment">// Convenient overload to initialize the Public Key via exported XML</span>
    <span class="token keyword">string</span> PublicKeyXml

    <span class="token comment">// How long should JWT Tokens be valid for. (default 14 days)</span>
    TimeSpan ExpireTokensIn

    <span class="token comment">// Convenient overload to initialize ExpireTokensIn with an Integer</span>
    <span class="token keyword">int</span> ExpireTokensInDays

    <span class="token comment">// How long should JWT Refresh Tokens be valid for. (default 365 days)</span>
    TimeSpan ExpireRefreshTokensIn 

    <span class="token comment">// Allow custom logic to invalidate JWT Tokens</span>
    Func<span class="token operator">&lt;</span>JsonObject<span class="token punctuation">,</span> IRequest<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> ValidateToken

    <span class="token comment">// Allow custom logic to invalidate Refresh Tokens</span>
    Func<span class="token operator">&lt;</span>JsonObject<span class="token punctuation">,</span> IRequest<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> ValidateRefreshToken

    <span class="token comment">// Whether to invalidate all JWT Tokens issued before a specified date.</span>
    DateTime<span class="token punctuation">?</span> InvalidateTokensIssuedBefore

    <span class="token comment">// Whether to populate the Bearer Token in the AuthenticateResponse</span>
    <span class="token keyword">bool</span> SetBearerTokenOnAuthenticateResponse

    <span class="token comment">// Modify the registration of ConvertSessionToToken Service</span>
    Dictionary<span class="token operator">&lt;</span>Type<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ServiceRoutes
<span class="token punctuation">}</span>
</code></pre></div><h3 id="further-examples" tabindex="-1">Further Examples <a class="header-anchor" href="#further-examples" aria-hidden="true">#</a></h3><p>More examples of both the new API Key and JWT Auth Providers are available in <a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.Server.Tests/Auth/StatelessAuthTests.cs" target="_blank" rel="noopener noreferrer">StatelessAuthTests</a> and <a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.WebHost.Endpoints.Tests/UseCases/JwtAuthProviderTests.cs#L235" target="_blank" rel="noopener noreferrer">JWT Token Cookie Example</a>.</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><a class="link" href="https://github.com/ServiceStack/docs/edit/master/docs/jwt-authprovider.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Edit this page on GitHub <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-07c132fc><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/sessions" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>Sessions</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/api-key-authprovider" data-v-38ede35f><span class="text" data-v-38ede35f>API Key AuthProvider</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"access-http-specific-features-in-services.md\":\"ac55d7f9\",\"add-servicestack-reference.md\":\"6155caa9\",\"adhoc-utils.md\":\"663e4912\",\"admin-ui-database.md\":\"19d67764\",\"admin-ui-features.md\":\"0865a6ca\",\"admin-ui-profiling.md\":\"fde9050d\",\"admin-ui-redis.md\":\"a1c8c62c\",\"admin-ui-users.md\":\"92c61df4\",\"admin-ui-validation.md\":\"7a90193a\",\"admin-ui.md\":\"dfb877d2\",\"advanced-deployment-octopus-deploy.md\":\"3dc9be33\",\"advantages-of-message-based-web-services.md\":\"ac1b58d2\",\"amazon-sqs-mq.md\":\"91dc8619\",\"api-design.md\":\"035f4424\",\"api-explorer-v1.md\":\"0db310d7\",\"api-explorer.md\":\"ae0902bc\",\"api-first-development.md\":\"a62490c9\",\"api-key-authprovider.md\":\"d8d2bb43\",\"app-tasks.md\":\"aee68a08\",\"appsettings.md\":\"54fb292f\",\"architecture-overview.md\":\"1cac0ae5\",\"artists.md\":\"56e624ff\",\"auth-anti-forgery.md\":\"7e0e09c7\",\"auth-openid.md\":\"6fb8331b\",\"auth-repository.md\":\"16d7e4a8\",\"auth-restricting-services.md\":\"3c527d54\",\"auth-signin-with-apple.md\":\"c7169710\",\"auth.md\":\"1c53f128\",\"authentication-and-authorization.md\":\"3a81e65f\",\"authentication-identity-aspnet.md\":\"74c50dbd\",\"authentication-identity-servicestack.md\":\"65bce101\",\"authentication-identityserver.md\":\"796284f8\",\"auto-batched-requests.md\":\"8387b898\",\"auto-html-api.md\":\"1dc5643b\",\"auto-mapping.md\":\"7c4350c7\",\"autoquery-audit-log.md\":\"e443ba8d\",\"autoquery-autogen.md\":\"27d073fb\",\"autoquery-crud-bookings.md\":\"95b1f60d\",\"autoquery-crud.md\":\"f530da11\",\"autoquery-data.md\":\"5d6999a5\",\"autoquery-dynamodb.md\":\"ba27a1f7\",\"autoquery-memory.md\":\"36ac0a75\",\"autoquery-rdbms.md\":\"dd81ebf2\",\"autoquery-service.md\":\"d8417967\",\"autoquery.md\":\"1d355d1c\",\"aws-getting-started.md\":\"a7d887cf\",\"aws-pocodynamo.md\":\"5b15a137\",\"aws.md\":\"632b623e\",\"azure-service-bus-mq.md\":\"9a12cdb9\",\"azure.md\":\"a978bd77\",\"background-mq.md\":\"821cfbe7\",\"benchmarks.md\":\"cb095dce\",\"blazor-diffusion.md\":\"82ef8d84\",\"blazor-litestream.md\":\"d4ba6658\",\"built-in-profiling.md\":\"a6b92d49\",\"bundling-and-minification.md\":\"51fa7e82\",\"cache-aware-clients.md\":\"3e4e4cba\",\"cacheresponse-attribute.md\":\"c843cb65\",\"caching.md\":\"34a67227\",\"cancellable-requests.md\":\"5ef883f9\",\"clients-overview.md\":\"982b4ce6\",\"code-contribution-guide.md\":\"90701278\",\"commonjs-add-servicestack-reference.md\":\"324f484e\",\"community-resources.md\":\"208944ba\",\"compiled-razor-views.md\":\"836012d2\",\"compression.md\":\"55dd6f57\",\"concurrency-model.md\":\"857df4e1\",\"config-api.md\":\"bf48e515\",\"contributing.md\":\"8b0c668d\",\"contributors.md\":\"52ac9682\",\"corsfeature.md\":\"93490ffc\",\"create-webservice-from-scratch.md\":\"b22da1c3\",\"create-your-first-webservice.md\":\"661c9d4b\",\"csharp-add-servicestack-reference.md\":\"eab75417\",\"csharp-client.md\":\"bd2aecf7\",\"csharp-server-events-client.md\":\"a257da56\",\"csv-format.md\":\"039abac1\",\"customize-http-responses.md\":\"6000bb1b\",\"customize-json-responses.md\":\"d7291b6a\",\"dart-add-servicestack-reference.md\":\"b0b55c73\",\"dart-client.md\":\"55daf5c0\",\"debugging.md\":\"5704d4f7\",\"declarative-validation.md\":\"403fad72\",\"deploy-multiple-sites-to-aws.md\":\"5e13aed2\",\"deploy-netcore-docker-aws-ecs.md\":\"312f86d2\",\"deploy-netcore-to-amazon-linux-2-ami.md\":\"cc1d401d\",\"design-message-based-apis.md\":\"d0c1c126\",\"design-rest-services.md\":\"fde5a386\",\"do-github-action-mix-deployment.md\":\"4ae73e78\",\"dotnet-new.md\":\"145718ee\",\"dotnet-tool.md\":\"cbbf85d1\",\"dump-utils.md\":\"079181a2\",\"encrypted-messaging.md\":\"54297740\",\"endpoints.md\":\"8a5819fa\",\"error-handling.md\":\"db5b99c9\",\"explore-servicestack.md\":\"e543cdb4\",\"filter-attributes.md\":\"aa192353\",\"flutter-grpc-mix.md\":\"2ff03775\",\"flutter-mix.md\":\"3bbff9d8\",\"flutter.md\":\"6118315b\",\"form-hijacking-prevention.md\":\"1cf1b631\",\"formats.md\":\"5cb41617\",\"fsharp-add-servicestack-reference.md\":\"c16b1edf\",\"fsharp.md\":\"f5e14283\",\"gh-nuget.md\":\"d2c572c7\",\"github-action-templates.md\":\"73966129\",\"grpc-android.md\":\"12b2b39b\",\"grpc-csharp.md\":\"f33aaabc\",\"grpc-dart.md\":\"5884ba36\",\"grpc-flutter.md\":\"b5c813ad\",\"grpc-generic.md\":\"35521f4b\",\"grpc-go.md\":\"e8c06d2d\",\"grpc-java.md\":\"aabc010f\",\"grpc-nodejs.md\":\"9b79f244\",\"grpc-php.md\":\"2f05b09e\",\"grpc-python.md\":\"ff8b37c3\",\"grpc-ruby.md\":\"4d4a4362\",\"grpc-ssl.md\":\"633d55f2\",\"grpc-swift.md\":\"63429304\",\"grpc.md\":\"99846849\",\"host-configuration.md\":\"255b8bb4\",\"hot-reloading.md\":\"59d995fc\",\"how-to-contribute.md\":\"7d4cf68d\",\"howto-write-unit-integration-tests.md\":\"2b243786\",\"html-css-and-javascript-minification.md\":\"2319568f\",\"html5reportformat.md\":\"7d7315f1\",\"http-caching.md\":\"21b21d4e\",\"http-utils.md\":\"d2dfac40\",\"iis.md\":\"ba120159\",\"index.md\":\"80e88a1a\",\"install-rabbitmq-windows.md\":\"5697efda\",\"install-redis-windows.md\":\"f35433df\",\"ioc.md\":\"ed437b36\",\"jamstack-with-vitepress-servicestack.md\":\"34e5a99e\",\"jamstacks-net.md\":\"4b19c8e0\",\"java-add-servicestack-reference.md\":\"41b18616\",\"java-server-events-client.md\":\"9c1f6119\",\"java.md\":\"ff0bdaac\",\"javascript-add-servicestack-reference.md\":\"4485e192\",\"javascript-client.md\":\"9a469593\",\"javascript-server-events-client.md\":\"3f028cb5\",\"js-utils.md\":\"d8aef9fc\",\"json-format.md\":\"962347de\",\"json-jsv-and-xml.md\":\"5756023b\",\"jsv-format.md\":\"de78885c\",\"jupyter-notebooks-csharp.md\":\"22f8ee19\",\"jupyter-notebooks-fsharp.md\":\"8a7497d6\",\"jupyter-notebooks-python.md\":\"f2fb36a0\",\"jupyter-notebooks-reporting.md\":\"9cecc812\",\"jupyter-notebooks.md\":\"9e30c95f\",\"jwt-authprovider.md\":\"008f2feb\",\"kotlin-add-servicestack-reference.md\":\"6d4a6782\",\"learning-servicestack.md\":\"8b729ce4\",\"linux-hosting-options.md\":\"d78cd195\",\"lisp-tcp-repl-server.md\":\"4c2898e1\",\"litestream-templates.md\":\"3ea738e9\",\"locode_advanced.md\":\"b60e9789\",\"locode_auditing.md\":\"dc231495\",\"locode_branding.md\":\"77fbd7c6\",\"locode_code-first.md\":\"2b214df3\",\"locode_custom-autoquerygrid.md\":\"2c72188a\",\"locode_custom-components-v1.md\":\"21377328\",\"locode_custom-components.md\":\"9e577862\",\"locode_custom-forms-v1.md\":\"35810ac7\",\"locode_custom-forms.md\":\"ecfdc1ff\",\"locode_custom.md\":\"b1e84d19\",\"locode_database-first.md\":\"96a48160\",\"locode_declarative.md\":\"62ab8186\",\"locode_files-blazor.md\":\"e0f28489\",\"locode_files-upload-aws.md\":\"7a82734b\",\"locode_files-upload-azure.md\":\"73ad048c\",\"locode_files-upload-filesystem.md\":\"e57160fe\",\"locode_files.md\":\"89f9db05\",\"locode_formatters.md\":\"a7eb7657\",\"locode_index.md\":\"b6d3bcdc\",\"locode_input.md\":\"481a9380\",\"locode_programmatic.md\":\"e4a6adc7\",\"locode_relations.md\":\"9fdb8730\",\"logging.md\":\"dc40554f\",\"markdown-razor.md\":\"3734b8e4\",\"messagepack-format.md\":\"286e1ce5\",\"messaging.md\":\"6d276b08\",\"metadata-page.md\":\"904486bc\",\"mix-github-actions-aws-ecs.md\":\"f4f11e71\",\"mix-tool.md\":\"b707f820\",\"modular-startup-legacy.md\":\"6ee68e88\",\"modular-startup.md\":\"7ee8b244\",\"modularizing-services.md\":\"62778cb7\",\"mono-repo.md\":\"35162da5\",\"mono.md\":\"80cf13d8\",\"multitenancy.md\":\"41c831ae\",\"mvc-integration.md\":\"d05acbd0\",\"myget.md\":\"807ddf61\",\"navigation.md\":\"d00d47e8\",\"netcore-deploy-rsync.md\":\"b3c54609\",\"netcore-localhost-cert.md\":\"f0161d5c\",\"netcore-razor.md\":\"538fec37\",\"netcore-redis.md\":\"a4370312\",\"netcore-windows-desktop.md\":\"20e09987\",\"netcore.md\":\"c1efa8a0\",\"nhibernate.md\":\"2ed69e05\",\"npm-new.md\":\"784cbfee\",\"nuget.md\":\"332084fb\",\"openapi.md\":\"e8da0866\",\"order-of-operations.md\":\"872bb661\",\"ormlite.md\":\"a5d2b01e\",\"ormlite_apis_delete.md\":\"7e0fd4b6\",\"ormlite_apis_insert.md\":\"d287542a\",\"ormlite_apis_schema.md\":\"ae648811\",\"ormlite_apis_select.md\":\"2243ada2\",\"ormlite_apis_update.md\":\"7cdf8f8d\",\"ormlite_async-apis.md\":\"7a362bb5\",\"ormlite_autogen-t4.md\":\"1477a949\",\"ormlite_aws-rds-databases.md\":\"2045b35f\",\"ormlite_complex-type-serializers.md\":\"4be031b0\",\"ormlite_custom-sql-features.md\":\"fec59eec\",\"ormlite_custom-sql.md\":\"65f6d30b\",\"ormlite_customer-orders-example.md\":\"6c171baa\",\"ormlite_db-migrations.md\":\"4c7314ec\",\"ormlite_dictionary-apis.md\":\"00695966\",\"ormlite_dynamic-result-sets.md\":\"8ce3fc71\",\"ormlite_ensure-apis.md\":\"442ec2a3\",\"ormlite_filters.md\":\"7ee6151a\",\"ormlite_getting-started.md\":\"a12a2d2e\",\"ormlite_index.md\":\"177da152\",\"ormlite_installation.md\":\"75691a13\",\"ormlite_introspection.md\":\"c2898e9e\",\"ormlite_limitations.md\":\"101caf24\",\"ormlite_litestream.md\":\"4056e7a1\",\"ormlite_multi-database-connections.md\":\"d5176635\",\"ormlite_optimistic-concurrency.md\":\"48dad0a1\",\"ormlite_ormlite-apis.md\":\"9aac7250\",\"ormlite_ormlite-utils.md\":\"790c6d4e\",\"ormlite_postgres-features.md\":\"c581fa78\",\"ormlite_reference-support.md\":\"2dddada2\",\"ormlite_shippers-example.md\":\"f283507c\",\"ormlite_sql-server-features.md\":\"b82431ac\",\"ormlite_stored-procedures.md\":\"e163a899\",\"ormlite_type-converters.md\":\"49df3b1e\",\"ormlite_typed-joins.md\":\"ce4c6ec1\",\"ormlite_untyped-apis.md\":\"861bc648\",\"oss.md\":\"9175681d\",\"physical-project-structure.md\":\"54511b1b\",\"plugins.md\":\"bdf8858f\",\"post-command.md\":\"659ace7d\",\"postman.md\":\"7ae5d62e\",\"prerequisites.md\":\"013e0e5f\",\"protobuf-format.md\":\"10d5c933\",\"proxy-feature.md\":\"1e9fd66f\",\"python-add-servicestack-reference.md\":\"915ac646\",\"rabbit-mq.md\":\"4ce7792a\",\"razor-notes.md\":\"29f0415a\",\"razor-ui-controls.md\":\"be63a26a\",\"razor-views-vs-content-pages.md\":\"54ab3239\",\"real-world-performance.md\":\"dbb72c0e\",\"redis-mq.md\":\"588ea990\",\"redis-server-events.md\":\"84b88244\",\"redis.md\":\"0f35dfff\",\"redis_async.md\":\"185c8b20\",\"redis_automatic-retries.md\":\"a200af25\",\"redis_client-managers.md\":\"b32fb8b5\",\"redis_client-usage.md\":\"e5a12cde\",\"redis_client.md\":\"c55fd370\",\"redis_custom-commands.md\":\"3e3a8013\",\"redis_design-nosql.md\":\"2ba6de8b\",\"redis_distributed-locking.md\":\"0155eb16\",\"redis_index.md\":\"c7d7189a\",\"redis_lua.md\":\"b1e50e88\",\"redis_profiling.md\":\"1dea9853\",\"redis_pubsub.md\":\"88ca9cba\",\"redis_redis-desktop.md\":\"3beca9aa\",\"redis_schemaless-migration.md\":\"5ba636e5\",\"redis_sentinel.md\":\"bc008740\",\"redis_stats.md\":\"c168c215\",\"redis_transactions.md\":\"556ca295\",\"redis_troubleshooting.md\":\"34cf909f\",\"redis_typed-client.md\":\"d96b47ab\",\"redis_typed-transactions.md\":\"ce5efeca\",\"reflection-utils.md\":\"5c4904f1\",\"register.md\":\"cc1c9b22\",\"release-notes-history.md\":\"e786def6\",\"release-notes-v3.md\":\"8dd140b7\",\"release-notes.md\":\"ea782f3d\",\"releases_2016-summary.md\":\"a08de680\",\"releases_index.md\":\"5a59082d\",\"releases_v4_0_0.md\":\"0ab717da\",\"releases_v4_0_06.md\":\"a7c99ac4\",\"releases_v4_0_08.md\":\"c5149191\",\"releases_v4_0_09.md\":\"f23e8563\",\"releases_v4_0_10.md\":\"1f06f0fe\",\"releases_v4_0_11.md\":\"0a07528d\",\"releases_v4_0_12.md\":\"9889338a\",\"releases_v4_0_15.md\":\"d7309108\",\"releases_v4_0_18.md\":\"7b8beabf\",\"releases_v4_0_19.md\":\"60f03680\",\"releases_v4_0_21.md\":\"3e78ab91\",\"releases_v4_0_22.md\":\"24f17498\",\"releases_v4_0_23.md\":\"f3a7ddef\",\"releases_v4_0_24.md\":\"4bbebf43\",\"releases_v4_0_30.md\":\"ed30e649\",\"releases_v4_0_31.md\":\"1999b7dc\",\"releases_v4_0_32.md\":\"e04aa8ae\",\"releases_v4_0_33.md\":\"a79ec099\",\"releases_v4_0_34.md\":\"5e3e77f4\",\"releases_v4_0_35.md\":\"87dfee0a\",\"releases_v4_0_36.md\":\"dcb68f4d\",\"releases_v4_0_38.md\":\"297ce8b3\",\"releases_v4_0_40.md\":\"1c1dc292\",\"releases_v4_0_42.md\":\"341839e0\",\"releases_v4_0_44.md\":\"00c2f6ff\",\"releases_v4_0_46.md\":\"2d7319c1\",\"releases_v4_0_48.md\":\"fcabfdec\",\"releases_v4_0_50.md\":\"1cdafbf1\",\"releases_v4_0_52.md\":\"ad2afb96\",\"releases_v4_0_54.md\":\"ea71a332\",\"releases_v4_0_56.md\":\"41ba562f\",\"releases_v4_0_58.md\":\"469022cc\",\"releases_v4_0_60.md\":\"fc43b703\",\"releases_v4_0_62.md\":\"75dbc3bd\",\"releases_v4_5_0.md\":\"d2830104\",\"releases_v4_5_10.md\":\"f55e07fd\",\"releases_v4_5_12.md\":\"7c609aaa\",\"releases_v4_5_14.md\":\"375020f8\",\"releases_v4_5_2.md\":\"b70045e9\",\"releases_v4_5_4.md\":\"b3046bbd\",\"releases_v4_5_6.md\":\"b7fa3b41\",\"releases_v4_5_8.md\":\"36d59330\",\"releases_v5_0_0.md\":\"1c87b4c4\",\"releases_v5_10.md\":\"384c073e\",\"releases_v5_11.md\":\"630a6975\",\"releases_v5_12.md\":\"6ff9fb98\",\"releases_v5_13.md\":\"98e0faba\",\"releases_v5_1_0.md\":\"a1ebe12c\",\"releases_v5_2.md\":\"6cbb2c24\",\"releases_v5_4.md\":\"366968d3\",\"releases_v5_5.md\":\"b81c3b19\",\"releases_v5_6.md\":\"cf61720b\",\"releases_v5_7.md\":\"7d14ae40\",\"releases_v5_8.md\":\"d3b5f3cf\",\"releases_v5_9.md\":\"0b37b033\",\"releases_v6.md\":\"05ef712d\",\"releases_v6_1.md\":\"bff5a6de\",\"releases_v6_2.md\":\"9631261b\",\"releases_v6_3.md\":\"9868b46a\",\"releases_v6_4.md\":\"3a745b4e\",\"releases_v6_5.md\":\"b320797a\",\"releases_v6_6.md\":\"6737af82\",\"releases_v6_7.md\":\"a8141cec\",\"releases_v6_8.md\":\"b2ec7f4e\",\"request-and-response-filters.md\":\"4b30d55d\",\"request-logger.md\":\"9dcf48c7\",\"roadmap.md\":\"bf799d0f\",\"routing.md\":\"9fd62e53\",\"search-test.md\":\"288cd2e2\",\"self-hosting.md\":\"ce712570\",\"serialization-deserialization.md\":\"83e47bfe\",\"server-events-grpc.md\":\"5bb47374\",\"server-events.md\":\"616a468c\",\"server-ui-controls.md\":\"0d64ebae\",\"service-complexity-and-dto-roles.md\":\"80506582\",\"service-discovery.md\":\"f9aba13b\",\"service-gateway.md\":\"42ab9438\",\"service-return-types.md\":\"d9f95b5f\",\"servicestack-as-daemon-on-linux.md\":\"8da83456\",\"servicestack-client-umd.md\":\"f01bb73c\",\"servicestack-handler-resolution.md\":\"cbd451c3\",\"servicestack-in-fastcgi-hosted-on-nginx.md\":\"746f52e7\",\"servicestack-integration.md\":\"41586bed\",\"servicestack-side-by-side-with-another-web-framework.md\":\"3049291c\",\"servicify.md\":\"e7fe5fa0\",\"sessions.md\":\"12df1e8b\",\"silverlight-client.md\":\"6c2e42a3\",\"simple-deployments-to-aws.md\":\"a9321ae3\",\"simple-ioc.md\":\"f9385a26\",\"sitemaps.md\":\"0946a344\",\"soap-support.md\":\"3681ce61\",\"ss-utils-js.md\":\"1e2260d7\",\"ssh-github-action-deployment.md\":\"6859e726\",\"ssl-redis-azure.md\":\"f976470c\",\"starlibs.md\":\"3a382199\",\"stripe.md\":\"14838bfc\",\"studio-autoquery.md\":\"0724ca82\",\"studio-users.md\":\"ff05d06b\",\"studio-validation-rules.md\":\"1abbeee4\",\"studio.md\":\"2b9adfba\",\"svg.md\":\"1a9affab\",\"swagger-api.md\":\"d476ff85\",\"swift-add-servicestack-reference.md\":\"4d94f8d5\",\"swift.md\":\"e06b2337\",\"templates-angular.md\":\"d65c0693\",\"templates-angularjs-v15.md\":\"42e947b0\",\"templates-aspnet-empty.md\":\"b895b926\",\"templates-aws.md\":\"e547b21b\",\"templates-blazor-components.md\":\"1ebbd186\",\"templates-blazor-server.md\":\"6c3e90cd\",\"templates-blazor-tailwind.md\":\"344c50e1\",\"templates-blazor.md\":\"4726fcc6\",\"templates-corefx.md\":\"b6e55c2e\",\"templates-desktop.md\":\"b1d6e31d\",\"templates-dotnet-scripts.md\":\"e1d1593a\",\"templates-empty.md\":\"b447389a\",\"templates-install-servicestackvs.md\":\"0ca0a0d9\",\"templates-jamstack.md\":\"ae4e516b\",\"templates-lite.md\":\"d7ea6cd6\",\"templates-mvc.md\":\"0fe458d7\",\"templates-nextjs.md\":\"889d6f3f\",\"templates-nuxt.md\":\"b906d901\",\"templates-overview.md\":\"121efacd\",\"templates-react.md\":\"a0f15362\",\"templates-single-page-apps.md\":\"99912aec\",\"templates-spa-components.md\":\"12c5e3a8\",\"templates-svelte.md\":\"b719720e\",\"templates-vue.md\":\"f2d0ff50\",\"templates-vuetify.md\":\"0b250624\",\"templates-webpack.md\":\"c7904fc5\",\"templates-websites.md\":\"f1782d36\",\"templates-windows-service.md\":\"4b3476ec\",\"testing.md\":\"d11e15be\",\"text.md\":\"dbaaf334\",\"text_index.md\":\"1253822e\",\"typescript-add-servicestack-reference.md\":\"4a5cdd6f\",\"typescript-server-events-client.md\":\"7ba55aa6\",\"validation.md\":\"b41957e6\",\"vbnet-add-servicestack-reference.md\":\"ba40c7f8\",\"vbnet.md\":\"05b29103\",\"versioning.md\":\"cda84677\",\"view-and-template-selection.md\":\"d9eafd92\",\"virtual-file-system.md\":\"8e3c1c56\",\"vue-components.md\":\"99dbede6\",\"vue_gallery_alerts.md\":\"c2d007bf\",\"vue_gallery_autocomplete.md\":\"7add4d6b\",\"vue_gallery_autoform-new.md\":\"e8be4033\",\"vue_gallery_autoform.md\":\"8ba50777\",\"vue_gallery_autoquerygrid.md\":\"280279f4\",\"vue_gallery_combobox.md\":\"2390d686\",\"vue_gallery_datagrid.md\":\"6809ab9b\",\"vue_gallery_fileinput.md\":\"42abb30b\",\"vue_gallery_form-inputs.md\":\"5632f6f4\",\"vue_gallery_formats.md\":\"0098546f\",\"vue_gallery_index.md\":\"2d946e56\",\"vue_gallery_modals.md\":\"f9b27fb0\",\"vue_gallery_navigation.md\":\"54cf74ea\",\"vue_gallery_taginput.md\":\"ae3d2135\",\"vue_index.md\":\"81753518\",\"vue_use-auth.md\":\"1746d031\",\"vue_use-client.md\":\"5d4f28e8\",\"vue_use-config.md\":\"3c90bd93\",\"vue_use-files.md\":\"135f2880\",\"vue_use-formatters.md\":\"8f2e2dfd\",\"vue_use-metadata.md\":\"c2782485\",\"vue_use-utils.md\":\"7b01ee49\",\"web-apply.md\":\"3c11c2c3\",\"web-new.md\":\"7cf037c0\",\"web-services.md\":\"e54e32cd\",\"web-tool.md\":\"23a7bd80\",\"web-trouble.md\":\"851fef08\",\"webhooks.md\":\"81aa8681\",\"what-is-a-message-based-web-service.md\":\"a9833380\",\"why-not-odata.md\":\"73a826ac\",\"why-not-razor.md\":\"d5f5ddfc\",\"why-remote-services-use-dtos.md\":\"04c53df4\",\"why-servicestack.md\":\"c35d6fa6\",\"wire-format.md\":\"6465586f\",\"world-validation.md\":\"a5db1d0b\",\"your-first-webservice-explained.md\":\"4eb55189\",\"ztest.md\":\"59429b03\"}")</script>
    <script type="module" async src="/assets/app.2aea72c0.js"></script>
    
  </body>
</html>